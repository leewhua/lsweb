var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},MarkerItemView=function(_super){function MarkerItemView(){var t=_super.call(this)||this;return t.showMenu=!1,t.initView(),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,t.touchClickHandler,t),t.addEventListener(egret.Event.ADDED_TO_STAGE,t.addStageHandler,t),t}return __extends(MarkerItemView,_super),MarkerItemView.prototype.addStageHandler=function(){this.alpha=0,this.scaleY=this.scaleX=0,egret.Tween.get(this).to({alpha:1,scaleX:1,scaleY:1},1e3)},MarkerItemView.prototype.touchClickHandler=function(t){this.data&&this.data.type>1&&PopManager.showPop("ThreePop",this.data.type)},MarkerItemView.prototype.initView=function(){this.txtName=new egret.TextField,this.txtName.background=!0,this.txtName.fontFamily="宋体",this.txtName.size=23,this.txtName.y=-60,this.addChild(this.txtName)},MarkerItemView.prototype.setData=function(t){this.data=t,t&&(this.txtName.text=t.name+"",this.txtName.x=-this.txtName.textWidth/2,this.txtName.backgroundColor=this.getTextColor(),this.monster=Global.createMc("monster_json","monster_png","m1"),this.addChild(this.monster),this.monster.anchorOffsetX=this.monster.width/2,this.monster.anchorOffsetY=this.monster.height/2,this.refreshPos())},MarkerItemView.prototype.getTextColor=function(){if(this.data){if(console.log(this.data.type),1==this.data.type)return 11722734;if(2==this.data.type)return 16766720;if(3==this.data.type)return 16776960;if(4==this.data.type)return 15643828}return 11674146},MarkerItemView.prototype.refreshPos=function(){if(this.data&&MapManager.instance.Gmap){var p=eval("MapManager.instance.Gmap.pointToPixel(new BMap.Point("+this.data.lng+","+this.data.lat+"))");this.x=p.x*(StageUtils.SW/StageUtils.LW),this.y=p.y*(StageUtils.SH/StageUtils.LH),console.log(p.x,p.y,this.x,this.y),this.monster&&this.monster.play(-1)}},MarkerItemView}(egret.DisplayObjectContainer);__reflect(MarkerItemView.prototype,"MarkerItemView");var SelfMarkerView=function(_super){function SelfMarkerView(){var t=_super.call(this)||this,e=new egret.Shape;e.graphics.beginFill(38655,.15),e.graphics.drawCircle(0,0,300),e.graphics.endFill(),t.addChild(e);var i=Global.createBitmapByName("self_png");return i.anchorOffsetX=i.width>>1,i.anchorOffsetY=i.height-16,t.addChild(i),t.head_tip=Global.createBitmapByName("head_tip_png"),t.head_tip.x=100,t.head_tip.y=235,UIManager.instance.topLayer.addChild(t.head_tip),t.head_tip.visible=!1,t}return __extends(SelfMarkerView,_super),SelfMarkerView.prototype.touchClickHandler=function(t){this.showMenu?this.head_tip.visible=!0:this.head_tip.visible=!1,this.showMenu=!this.showMenu},SelfMarkerView.prototype.setData=function(){this.data={},this.txtName.text=UserInfo.instance.username,this.txtName.x=-this.txtName.textWidth/2,this.txtName.y=0,this.txtName.textColor=5900950,this.txtName.background=!1,this.loadHead(),this.refreshPos()},SelfMarkerView.prototype.loadHead=function(){var t=UserInfo.instance.url,e=this,i=new CustomImage(t,!1,function(){i.width=95,i.height=95,i.x=-48,i.y=-120;var t=new egret.Shape;t.graphics.beginFill(0),t.graphics.drawCircle(50,50,45),t.x=i.x,t.y=i.y,i.mask=t,e.addChild(i),e.addChild(t)});this.head=i,this.addChild(i)},SelfMarkerView.prototype.onLoadComplete=function(t){var e=t.target,i=e.data,o=new egret.Bitmap(i);o.width=70,o.height=70,o.x=-35,o.y=-35;var s=new egret.Shape;s.graphics.beginFill(0),s.graphics.drawCircle(35,35,35),s.x=-35,s.y=-35,o.mask=s,this.addChild(o),this.addChild(s),this.head=o},SelfMarkerView.prototype.refreshPos=function(){if(MapManager.instance.Gmap){var p=eval("MapManager.instance.Gmap.pointToPixel(new BMap.Point("+MapManager.instance.lng+","+MapManager.instance.lat+"))");this.x=p.x*(StageUtils.SW/StageUtils.LW),this.y=p.y*(StageUtils.SH/StageUtils.LH),console.log(p.x,p.y,this.x,this.y),this.monster&&this.monster.play(-1)}},SelfMarkerView}(MarkerItemView);__reflect(SelfMarkerView.prototype,"SelfMarkerView");var PopView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(){var t=new egret.Shape;t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,StageUtils.stage.stageWidth,StageUtils.stage.stageHeight),t.graphics.endFill(),this.addChildAt(t,0),t.alpha=0,Global.fadeIn(t),UIManager.instance.popLayer.addChild(this),this.touchEnabled=!0},e.prototype.hide=function(){UIManager.instance.popLayer.removeChild(this)},e.prototype.setData=function(t){void 0===t&&(t=null),this.data=t},e}(egret.DisplayObjectContainer);__reflect(PopView.prototype,"PopView");var ErrorCode=function(){function t(){}return t}();ErrorCode.TIME_OUT=999,ErrorCode.NOT_FOUND=404,ErrorCode.SYSTEM_ERROR=100,ErrorCode.TICKET_TIME_OUT=1,ErrorCode.RECEIVED_SELF=2,ErrorCode.RECEIVED_OTHER=3,ErrorCode.RECEIVED_ERROR=4,__reflect(ErrorCode.prototype,"ErrorCode");var MapView=function(t){function e(){var e=t.call(this)||this;return e.markerLayer=new egret.DisplayObjectContainer,e.addChild(e.markerLayer),e.selfLayer=new egret.DisplayObjectContainer,e.addChild(e.selfLayer),e.itemList=[],e.itemDic={},e.otherDic={},e.companyDic={},e.virCompDic={},e.threeDic={},e}return __extends(e,t),e.prototype.refreshSelf=function(){this.self?this.self.refreshPos():(this.self=new SelfMarkerView,this.self.setData(),this.selfLayer.addChild(this.self))},e.prototype.refreshOther=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];if(o){var s=this.findMarkerByID(o.id,this.otherDic);s?s.refreshPos():(s=new OtherMarkerView,s.setData(o),this.selfLayer.addChild(s),this.otherDic[o.id]=s)}}},e.prototype.refreshCompany=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];if(o){var s=this.findMarkerByID(o.id,this.companyDic);s?s.refreshPos():(s=new MarkerItemView,s.setData(o),this.selfLayer.addChild(s),this.companyDic[o.id]=s)}}},e.prototype.refreshVIRComp=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];if(o){var s=this.findMarkerByID(o.id,this.virCompDic);s?s.refreshPos():(s=new MarkerItemView,s.setData(o),this.selfLayer.addChild(s),this.virCompDic[o.id]=s)}}},e.prototype.refreshThree=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];if(o){var s=this.findMarkerByID(o.id,this.threeDic);s?s.refreshPos():(s=new MarkerItemView,s.setData(o),this.selfLayer.addChild(s),this.threeDic[o.id]=s)}}},e.prototype.refreshMap=function(){this.self&&this.self.refreshPos();for(var t in this.otherDic){var e=this.otherDic[t];e&&e.refreshPos()}for(var t in this.companyDic){var e=this.companyDic[t];e&&e.refreshPos()}for(var t in this.virCompDic){var e=this.virCompDic[t];e&&e.refreshPos()}for(var t in this.threeDic){var e=this.threeDic[t];e&&e.refreshPos()}},e.prototype.findMarkerByID=function(t,e){for(var i in e)if(i==t)return e[i];return null},e.prototype.findMarker=function(t){for(var e=this.itemList.length,i=0;e>i;i++){var o=this.itemList[i];if(o&&o.data.id==t.id)return o}return null},e}(egret.DisplayObjectContainer);__reflect(MapView.prototype,"MapView");var CustomCheckBox=function(t){function e(e,i,o){void 0===o&&(o=0);var s=t.call(this)||this;return s.type=e,s.text=i,s.select=o,s.init(),s}return __extends(e,t),e.prototype.init=function(){console.log(),this.icon=Global.createBitmapByName("cbx_"+this.type+"_"+this.select+"_png"),this.addChild(this.icon),this.txtContent=new egret.TextField,this.txtContent.x=50,this.txtContent.text=this.text,this.addChild(this.txtContent),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this)},e.prototype.clickHandler=function(){this.change(),this.dispatchEventWith(egret.Event.CHANGE)},e.prototype.setSelect=function(t){this.select=t,this.icon.texture=RES.getRes("cbx_"+this.type+"_"+this.select+"_png")},e.prototype.change=function(){this.setSelect(0==this.select?1:0)},e}(egret.DisplayObjectContainer);__reflect(CustomCheckBox.prototype,"CustomCheckBox");var OtherMarkerView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.touchClickHandler=function(t){this.showMenu?MenuView.instance.showMenu(this):MenuView.instance.showMenu(this,MenuView.OTHER_MENU),this.showMenu=!this.showMenu},e}(SelfMarkerView);__reflect(OtherMarkerView.prototype,"OtherMarkerView");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.index=3,e.loadOk=!1,e.lastOk=!1,e.createView(),e}return __extends(e,t),e.prototype.createView=function(){if(this.isload=window.sessionStorage.getItem("loading_load"),"1"==this.isload)this.lastOk=!0;else{var t=new CustomImage("resource/assets/loading/loading_bg.jpg",!0,function(){t.width=StageUtils.SW,t.height=StageUtils.SH});this.addChild(t);var e=new CustomImage("resource/assets/loading/loading_btn.png",!1,function(){e.x=StageUtils.SW-e.width-30,e.y=30});this.addChild(e),this.btnReturn=e,this.txtLasttime1=new egret.TextField,this.addChild(this.txtLasttime1),this.txtLasttime1.textColor=6710886,this.txtLasttime1.size=22,this.txtLasttime1.x=StageUtils.SW-100-30,this.txtLasttime1.y=37,this.txtLasttime1.width=100,this.txtLasttime1.textAlign="center",this.txtLasttime1.text="跳过 3S",this.txtLasttime=new egret.TextField,this.addChild(this.txtLasttime),this.txtLasttime.size=22,this.txtLasttime.x=StageUtils.SW-100-30,this.txtLasttime.y=37,this.txtLasttime.width=100,this.txtLasttime.textAlign="center",this.txtLasttime.text="跳过 3S",this.rectMask=new egret.Rectangle(0,0,100,50),this.rectMask.x=-100,this.txtLasttime.mask=this.rectMask,this.timer=new egret.Timer(1e3,3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this.timer.start()}},e.prototype.timerHandler=function(){this.index--,this.index>0?(this.txtLasttime.text="跳过 "+this.index+"S",this.txtLasttime.mask=this.rectMask,this.txtLasttime1.text="跳过 "+this.index+"S"):(this.timer.stop(),this.timer.removeEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this.timer=null,this.txtLasttime.text="跳  过",this.txtLasttime.mask=this.rectMask,this.txtLasttime1.text="跳  过",this.lastOk=!0,this.checkInto())},e.prototype.checkInto=function(){this.loadOk&&this.lastOk&&(this.btnReturn&&(Global.setBut(this.btnReturn),this.btnReturn.touchEnabled=!0,this.btnReturn.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClickHandler,this)),this.returnClickHandler())},e.prototype.returnClickHandler=function(){UIManager.instance.mainUILayer.removeChild(this),UIManager.instance.initMainView()},e.prototype.setProgress=function(t,e){if("1"!=this.isload){var i=Math.floor(t/e*100);StageUtils.SW-102-30;this.rectMask.x=-100+i,this.txtLasttime.mask=this.rectMask}},e.prototype.loadComp=function(){window.sessionStorage.setItem("loading_load","1"),this.txtLasttime&&(this.txtLasttime.mask=null),this.rectMask=null,this.loadOk=!0,this.checkInto()},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var MenuItemView=function(t){function e(){var e=t.call(this)||this;return e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_TAP,e.touchClickHandler,e),e}return __extends(e,t),e.prototype.touchClickHandler=function(t){this.data&&alert("menu_item_id:"+this.data.id)},e.prototype.setData=function(t){this.data=t,t&&(this.icon=Global.createBitmapByName("btn_func"+t.icon+"_png"),this.icon.x=-this.icon.width>>1,this.icon.y=-this.icon.height>>1,this.addChild(this.icon),this.x=t.x,this.y=t.y)},e}(egret.DisplayObjectContainer);__reflect(MenuItemView.prototype,"MenuItemView");var MenuView=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.showMenu=function(t,e){if(void 0===e&&(e=null),this.removeChildren(),e){for(var i=e.length,o=0;i>o;o++){var s=new MenuItemView;s.setData(e[o]),this.addChild(s),s.scaleX=s.scaleY=0,egret.Tween.get(s).wait(100*o).to({scaleX:1,scaleY:1},300)}t.addChild(this),StageUtils.stage.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)}else StageUtils.stage.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this),this.parent&&this.parent.removeChild(this)},e.prototype.touchHandler=function(t){this.showMenu(null)},e}(egret.DisplayObjectContainer);MenuView.SELF_MENU=[{id:1,icon:1,x:-57,y:21},{id:2,icon:1,x:-25,y:58},{id:3,icon:1,x:25,y:58},{id:4,icon:1,x:57,y:21}],MenuView.OTHER_MENU=[{id:1,icon:1,x:-25,y:58},{id:2,icon:1,x:25,y:58}],__reflect(MenuView.prototype,"MenuView");var MapManager=function(){function MapManager(){this.isFirst=!0,this.duiUserName="有X的男人",setTimeout(function(){MapManager.instance.enterFrameHandler()},100),this.itemList=[],this.mapView=new MapView,UIManager.instance.mapLayer.addChild(this.mapView)}return Object.defineProperty(MapManager,"USER_INFO_API",{get:function(){return MapManager.ROOT+"info?"+Math.random()},enumerable:!0,configurable:!0}),Object.defineProperty(MapManager,"PLAY_API",{get:function(){return MapManager.ROOT+"play?"+Math.random()},enumerable:!0,configurable:!0}),MapManager.prototype.enterFrameHandler=function(){eval("$.scriptReady")?this.getLoct():setTimeout(function(){MapManager.instance.enterFrameHandler()},100)},MapManager.prototype.initMap=function(){this.Gmap=eval("new BMap.Map('GameMap',{enableHighResolution:true,enableMapClick:false});"),this.curMapLevel=17,this.Gmap.centerAndZoom(eval("new BMap.Point("+this.lng+", "+this.lat+")"),this.curMapLevel),this.Gmap.disableDragging(),this.Gmap.disableScrollWheelZoom(),this.Gmap.disableDoubleClickZoom(),this.Gmap.disableKeyboard(),this.Gmap.disableInertialDragging(),console.log("地图初始化完毕")},MapManager.prototype.getLoct=function(){console.log("getLoct");var geolocation=eval("new BMap.Geolocation();");geolocation.getCurrentPosition(function(r){geolocation.getStatus()==eval("BMAP_STATUS_SUCCESS")?(MapManager.instance.lng=r.point.lng,MapManager.instance.lat=r.point.lat,MapManager.instance.isFirst&&(MapManager.instance.isFirst=!1,MapManager.instance.initMap(),MapManager.instance.Gmap.centerAndZoom(eval("new BMap.Point("+MapManager.instance.lng+", "+MapManager.instance.lat+")"),17)),MapManager.instance.loadDate()):(alert("failed"+geolocation.getStatus()),MapManager.instance.loadDate())},{enableHighAccuracy:!0})},MapManager.prototype.share=function(isGet){void 0===isGet&&(isGet=0);var wxObj=eval("wx");wxObj&&eval("$.wxIsReady")?(wxObj.onMenuShareTimeline({title:"你过来，有个惊喜要给你看",link:"http://res.leasiondata.cn/lstatic/c/v3/index.html?share,"+isGet+","+UserInfo.instance.username+","+UserInfo.instance.url,imgUrl:"http://res.leasiondata.cn/lstatic/c/share/share_icon.jpg",success:function(){},cancel:function(){}}),wxObj.onMenuShareAppMessage({title:"你过来，有个惊喜要给你看",desc:"点击进入",link:"http://res.leasiondata.cn/lstatic/c/v3/index.html?share,"+isGet+","+UserInfo.instance.username+","+UserInfo.instance.url,imgUrl:"http://res.leasiondata.cn/lstatic/c/share/share_icon.jpg",success:function(){},cancel:function(){}})):egret.setTimeout(this.share,this,500,isGet)},MapManager.prototype.loadDate=function(){var t={},e=this.lng,i=this.lat;t=e>0&&i>0?{type:"info",lng:e,lat:i,ticket:MapManager.USER_TICKET}:{type:"info",ticket:MapManager.USER_TICKET},console.log("xy:"+e,i);var o=this;$.ajax({url:MapManager.USER_INFO_API,data:t,success:function(t){if("success"==t.result){UserInfo.instance.username=decodeURI(t.nickname);var e=t.headimgurl.substr(0,t.headimgurl.length-1);e+="132",UserInfo.instance.url=e,o.duiUserName=t.nickname,o.mapView.refreshSelf(),MainView.instance.showInfo(),MainView.instance.showShop(UserInfo.instance.shopList),MainView.instance.showPingZi(),0!=t.pools.length?(UserInfo.instance.isget=!1,PopManager.showPop("TipsPop"),MainView.instance.showBox(),sessionStorage.setItem("ticket",t.pools[0].ticket)):(UserInfo.instance.isget=!0,PopManager.showPop("ReceivedPop")),MainView.instance.initSmallShop(),o.share(0)}else PopManager.showPop("ErrorPop",2)},error:function(){setTimeout(o.getLoct,5e3)},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&setTimeout(o.getLoct,5e3)}})},MapManager.prototype.refreshMap=function(){this.Gmap.centerAndZoom(eval("new BMap.Point("+this.serverLng+", "+this.serverLat+")"),this.curMapLevel),this.mapView.refreshMap()},Object.defineProperty(MapManager,"instance",{get:function(){return MapManager._instance||(MapManager._instance=new MapManager),MapManager._instance},enumerable:!0,configurable:!0}),MapManager}();MapManager.isShared=0,MapManager.USER_TICKET="03cb5224f3474f0eb7cfa64cfea4cf49",MapManager.PLAY_TICKET="",MapManager.ROOT="http://coeasion.cn/",MapManager.AnswerList=[{title:"顶破天(打一字)",answer:"夫"},{title:"半耕半读(打一字)",answer:"讲"}],__reflect(MapManager.prototype,"MapManager");var PopManager=function(){function PopManager(){}return PopManager.showPop=function(pop,data){void 0===data&&(data=null);var view=PopManager.popDic[pop];view?view.setData(data):(view=eval("new "+pop+"()"),view&&view.setData(data),PopManager.popDic[pop]=view),view.show()},PopManager.hidePop=function(t){var e=PopManager.popDic[t];e?(e.hide(),delete PopManager.popDic[t]):console.log(t+":不存在")},PopManager}();PopManager.popDic={},__reflect(PopManager.prototype,"PopManager");var Main=function(t){function e(){var e=t.call(this)||this;return e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){if(StageUtils.registStage(this.stage),this.addChild(UIManager.instance),this.loadingView=new LoadingUI,UIManager.instance.mainUILayer.addChild(this.loadingView),e.isTest)return UserInfo.instance.url="http://wx.qlogo.cn/mmopen/6BD2qP9V7sout0oux0ts55Pns1xtEpOl7icGF5GV68YdruILNBBCJvMMFCy0Wbbl7zFiaibjfibaIlKFcYIhRM6ntCU37lhk8amY/0",UserInfo.instance.username="有X的男人",RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),void RES.loadConfig("resource/default.res.json","resource/");if(this.getData()){if(UserInfo.instance.isShare)return;RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")}else RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.getData=function(){var t,i=window.location.href.split("#")[0].split("?")[1];if(console.log("loadUser"),e.isTest)return!0;if(i){t=i.split("$");var o=t[0].split("=")[0].split(",");return MapManager.USER_TICKET=o[0],MapManager.PLAY_TICKET=o[1],"share"==o[0]&&(UserInfo.instance.isShare=!0,PopManager.showPop("ShareIntoPop",{isget:o[1],username:o[2],url:o[3]})),!0}return!1},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("main")},e.prototype.onResourceLoadComplete=function(t){"main"==t.groupName&&(RES.removeEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.removeEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.removeEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.removeEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),this.loadingView.loadComp())},e.prototype.onItemLoadError=function(t){Message.show("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){Message.show("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"main"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e}(egret.DisplayObjectContainer);Main.isTest=!1,__reflect(Main.prototype,"Main");var ItemBox=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.init=function(t,e){void 0===e&&(e=1),this.type=t,this.dir=e,this.icon=Global.createBitmapByName("box_"+this.type+"_png"),this.addChild(this.icon),this.setRotate(this.dir)},e.prototype.changeDir=function(){this.dir++,this.dir>4&&(this.dir=1),this.setRotate(this.dir)},e.prototype.preDir=function(){var t=this.dir;return t++,t>4&&(t=1),this.preRotate(t)},e.prototype.refreshPos=function(t,e){this.px=t,this.py=e,this.x=TetrisGame.size*this.px,this.y=TetrisGame.size*this.py},e.prototype.preRotate=function(t){var e=this.type;return 1==e?[[0,0,0,0],[0,0,0,0],[0,1,1,0],[0,1,1,0]]:2==e?1==t||3==t?[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]]:[[1,1,1,1],[0,0,0,0],[0,0,0,0],[0,0,0,0]]:3==e?1==t?[[0,0,0,0],[0,0,0,0],[1,0,0,0],[1,1,1,0]]:2==t?[[0,0,0,0],[0,1,0,0],[0,1,0,0],[1,1,0,0]]:3==t?[[0,0,0,0],[0,0,0,0],[1,1,1,0],[0,0,1,0]]:[[0,0,0,0],[1,1,0,0],[1,0,0,0],[1,0,0,0]]:4==e?1==t?[[0,0,0,0],[0,1,0,0],[1,1,0,0],[0,1,0,0]]:2==t?[[0,0,0,0],[0,0,0,0],[1,1,1,0],[0,1,0,0]]:3==t?[[0,0,0,0],[0,1,0,0],[0,1,1,0],[0,1,0,0]]:[[0,0,0,0],[0,1,0,0],[1,1,1,0],[0,0,0,0]]:5==e?1==t||3==t?[[0,0,0,0],[0,0,0,0],[0,1,1,0],[1,1,0,0]]:[[0,0,0,0],[1,0,0,0],[1,1,0,0],[0,1,0,0]]:6==e?1==t||3==t?[[0,0,0,0],[0,1,0,0],[1,1,0,0],[1,0,0,0]]:[[0,0,0,0],[0,0,0,0],[1,1,0,0],[0,1,1,0]]:7==e?1==t?[[0,0,0,0],[0,0,0,0],[0,0,1,0],[1,1,1,0]]:2==t?[[0,0,0,0],[1,1,0,0],[0,1,0,0],[0,1,0,0]]:3==t?[[0,0,0,0],[0,0,0,0],[1,1,1,0],[1,0,0,0]]:[[0,0,0,0],[1,0,0,0],[1,0,0,0],[1,1,0,0]]:void 0},e.prototype.setRotate=function(t){var e=this.type;1==e?(this.list=[[0,0,0,0],[0,0,0,0],[0,1,2,0],[0,3,4,0]],this.icon.x=TetrisGame.size,this.icon.y=2*TetrisGame.size,this.icon.rotation=0):2==e?1==t||3==t?(this.list=[[1,0,0,0],[2,0,0,0],[3,0,0,0],[4,0,0,0]],this.icon.x=0,this.icon.y=0,this.icon.rotation=0):(this.list=[[1,2,3,4],[0,0,0,0],[0,0,0,0],[0,0,0,0]],this.icon.x=0,this.icon.y=TetrisGame.size,this.icon.rotation=-90):3==e?1==t?(this.list=[[0,0,0,0],[0,0,0,0],[1,0,0,0],[2,3,4,0]],this.icon.x=0,this.icon.y=2*TetrisGame.size,this.icon.rotation=0):2==t?(this.list=[[0,0,0,0],[0,4,0,0],[0,3,0,0],[1,2,0,0]],this.icon.x=0,this.icon.y=4*TetrisGame.size,this.icon.rotation=-90):3==t?(this.list=[[0,0,0,0],[0,0,0,0],[4,3,2,0],[0,0,1,0]],this.icon.x=3*TetrisGame.size,this.icon.y=4*TetrisGame.size,this.icon.rotation=-180):(this.list=[[0,0,0,0],[2,1,0,0],[3,0,0,0],[4,0,0,0]],this.icon.x=2*TetrisGame.size,this.icon.y=TetrisGame.size,this.icon.rotation=-270):4==e?1==t?(this.list=[[0,0,0,0],[0,1,0,0],[2,3,0,0],[0,4,0,0]],this.icon.x=0,this.icon.y=TetrisGame.size,this.icon.rotation=0):2==t?(this.list=[[0,0,0,0],[0,0,0,0],[1,3,4,0],[0,2,0,0]],this.icon.x=0,this.icon.y=4*TetrisGame.size,this.icon.rotation=-90):3==t?(this.list=[[0,0,0,0],[0,4,0,0],[0,3,2,0],[0,1,0,0]],this.icon.x=3*TetrisGame.size,this.icon.y=4*TetrisGame.size,this.icon.rotation=-180):(this.list=[[0,0,0,0],[0,2,0,0],[4,3,1,0],[0,0,0,0]],this.icon.x=3*TetrisGame.size,this.icon.y=TetrisGame.size,this.icon.rotation=-270):5==e?1==t||3==t?(this.list=[[0,0,0,0],[0,0,0,0],[0,1,2,0],[3,4,0,0]],this.icon.x=0,this.icon.y=2*TetrisGame.size,this.icon.rotation=0):(this.list=[[0,0,0,0],[2,0,0,0],[1,4,0,0],[0,3,0,0]],this.icon.x=0,this.icon.y=4*TetrisGame.size,this.icon.rotation=-90):6==e?1==t||3==t?(this.list=[[0,0,0,0],[0,1,0,0],[2,3,0,0],[4,0,0,0]],this.icon.x=0,this.icon.y=TetrisGame.size,this.icon.rotation=0):(this.list=[[0,0,0,0],[0,0,0,0],[4,2,0,0],[0,3,1,0]],this.icon.x=0,this.icon.y=4*TetrisGame.size,this.icon.rotation=-90):7==e&&(1==t?(this.list=[[0,0,0,0],[0,0,0,0],[0,0,1,0],[2,3,4,0]],this.icon.x=0,this.icon.y=2*TetrisGame.size,this.icon.rotation=0):2==t?(this.list=[[0,0,0,0],[1,4,0,0],[0,3,0,0],[0,2,0,0]],this.icon.x=0,this.icon.y=4*TetrisGame.size,this.icon.rotation=-90):3==t?(this.list=[[0,0,0,0],[0,0,0,0],[4,3,2,0],[1,0,0,0]],this.icon.x=3*TetrisGame.size,this.icon.y=4*TetrisGame.size,this.icon.rotation=-180):(this.list=[[0,0,0,0],[2,0,0,0],[3,0,0,0],[4,1,0,0]],this.icon.x=2*TetrisGame.size,this.icon.y=TetrisGame.size,this.icon.rotation=-270))},e.prototype.getButtomIndex=function(){for(var t=this.list.length,e=t-1;e>=0;e--)for(var i=this.list[e],o=i.length,s=0;o>s;s++)if(1==i[s])return console.log(this.py+e),this.py+e;return console.log(0),0},e}(egret.DisplayObjectContainer);__reflect(ItemBox.prototype,"ItemBox");var TetrisGame=function(t){function e(){var e=t.call(this)||this;return e.score=0,e.step=0,e.ok18=!1,e.ok19=!1,e.initLine(),e}return __extends(e,t),e.prototype.initLine=function(){var t=Global.createBitmapByName("kuang_png");t.width=e.maxW+8,t.height=e.maxH+8,t.x=(StageUtils.SW-t.width>>1)-4,t.y=(StageUtils.SH-t.height>>1)-4,this.addChild(t),e.initX=t.x+4,e.initY=t.y+4,this.boxContainer=new egret.DisplayObjectContainer,this.boxContainer.x=e.initX,this.boxContainer.y=e.initY,this.addChild(this.boxContainer);for(var i=0;20>i;i++){var o=new egret.Shape;o.graphics.lineStyle(2,16777215,.5),o.graphics.moveTo(0,i*e.size),o.graphics.lineTo(e.maxW,i*e.size),o.graphics.endFill(),this.boxContainer.addChild(o)}for(var i=0;10>i;i++){var o=new egret.Shape;o.graphics.lineStyle(2,16777215,.5),o.graphics.moveTo(i*e.size,0),o.graphics.lineTo(i*e.size,e.maxH),o.graphics.endFill(),this.boxContainer.addChild(o)}this.list=[];for(var i=0;20>i;i++){for(var s=[],n=0;10>n;n++)s[n]=0;this.list.push(s)}this.boxList={},this.txtScore=new egret.TextField,this.txtScore.textColor=0,this.txtScore.text="score:0",this.addChild(this.txtScore),this.txtStep=new egret.TextField,this.txtStep.textColor=16711935,this.txtStep.text="step:0",this.txtStep.y=50,this.addChild(this.txtStep),this.initEvent(),this.randomBox(),this.initData(),this.stepTimer=new egret.Timer(500),this.stepTimer.addEventListener(egret.TimerEvent.TIMER,this.stepTimerHandler,this),this.stepTimer.start()},e.prototype.initData=function(){for(var t=16;20>t;t++)for(var i=this.list[t],o=i.length,s=0;o>s;s++)if(i[s]=Math.floor(2*Math.random()),i[s]>0){var n=Math.ceil(7*Math.random()),r=Math.ceil(4*Math.random()),a=Global.createBitmapByName(n+"_"+r+"_png");a.x=s*e.size,a.y=t*e.size,this.boxContainer.addChild(a),this.boxList[t+"_"+s]=a}this.list[18][4]=1,this.list[18][5]=1,this.list[19][4]=1,this.list[19][5]=1;var h=this.boxList["18_4"];h?h.texture=RES.getRes("box_red_png"):(h=Global.createBitmapByName("box_red_png"),h.x=4*e.size,h.y=18*e.size,this.boxContainer.addChild(h),this.boxList["18_4"]=h);var h=this.boxList["18_5"];h?h.texture=RES.getRes("box_red_png"):(h=Global.createBitmapByName("box_red_png"),h.x=5*e.size,h.y=18*e.size,this.boxContainer.addChild(h),this.boxList["18_5"]=h);var h=this.boxList["19_4"];h?h.texture=RES.getRes("box_red_png"):(h=Global.createBitmapByName("box_red_png"),h.x=4*e.size,h.y=19*e.size,this.boxContainer.addChild(h),this.boxList["19_4"]=h);var h=this.boxList["19_5"];h?h.texture=RES.getRes("box_red_png"):(h=Global.createBitmapByName("box_red_png"),h.x=5*e.size,h.y=19*e.size,this.boxContainer.addChild(h),this.boxList["19_5"]=h)},e.prototype.stepTimerHandler=function(){this.downBox()},e.prototype.initEvent=function(){var t=Global.createBitmapByName("arrow_png");t.rotation=180,t.x=t.width,t.y=StageUtils.SH-1*t.height-50,this.addChild(t);var e=Global.createBitmapByName("arrow_png");e.x=StageUtils.SW-e.width,e.y=StageUtils.SH-2*e.height-50,this.addChild(e);var i=Global.createBitmapByName("arrow_png");i.rotation=270,i.x=0,i.y=StageUtils.SH-25,this.addChild(i);var o=Global.createBitmapByName("arrow_png");o.rotation=90,o.x=StageUtils.SW,o.y=StageUtils.SH-1*o.height-25,this.addChild(o),t.touchEnabled=!0,e.touchEnabled=!0,i.touchEnabled=!0,o.touchEnabled=!0,Global.setBut(t),Global.setBut(e),Global.setBut(i),Global.setBut(o),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.leftHandler,this),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.rightHandler,this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.upHandler,this),o.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.downHandler,this),o.addEventListener(egret.TouchEvent.TOUCH_END,this.downEndHandler,this),o.addEventListener(egret.TouchEvent.TOUCH_CANCEL,this.downEndHandler,this),o.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.downEndHandler,this)},e.prototype.leftHandler=function(){this.select&&(this.select.px--,this.check(this.select,this.select.list)?this.select.refreshPos(this.select.px,this.select.py):this.select.px++)},e.prototype.rightHandler=function(){this.select&&(this.select.px++,this.check(this.select,this.select.list)?this.select.refreshPos(this.select.px,this.select.py):this.select.px--)},e.prototype.upHandler=function(){if(this.select){var t=this.select.preDir();this.check(this.select,t)&&this.select.changeDir()}},e.prototype.downHandler=function(){this.stepTimer.delay=50},e.prototype.downEndHandler=function(){this.stepTimer.delay=500},e.prototype.downBox=function(){this.select&&(this.select.py++,this.check(this.select,this.select.list)?this.select.refreshPos(this.select.px,this.select.py):(this.select.py--,this.updateList(this.select),this.boxContainer.removeChild(this.select),this.select=null,this.checkScore(),this.randomBox()))},e.prototype.checkScore=function(){for(var t=0,e=this.list.length,i=0;e>i;i++){for(var o=this.list[i],s=o.length,n=!0,r=0;s>r;r++)if(0==o[r]){n=!1;break}if(n){for(var r=0;s>r;r++){var a=this.boxList[i+"_"+r];a&&(this.boxContainer.removeChild(a),delete this.boxList[i+"_"+r])}this.listDownMove(i),t++,18==i?this.ok18=!0:19==i&&(this.ok19=!0),this.ok18&&this.ok19&&(this.stepTimer.stop(),alert("pass:"+this.step+"步,"+this.score+"分"))}}this.score+=1e3*t,this.txtScore.text="score:"+this.score},e.prototype.listDownMove=function(t){for(var i=(this.list.length,t);i>0;i--)for(var o=this.list[i],s=this.list[i-1],n=o.length,r=0;n>r;r++){var a=this.boxList[i-1+"_"+r];a&&(a.x=r*e.size+(a.width>>1),a.y=i*e.size+(a.height>>1)),o[r]=s[r],a?this.boxList[i+"_"+r]=a:delete this.boxList[i+"_"+r],delete this.boxList[i-1+"_"+r]}},e.prototype.check=function(t,i){if(t.getButtomIndex()>20)return!1;for(var o=i.length,s=0;o>s;s++)for(var n=i[s],r=n.length,a=0;r>a;a++)if(i[s][a]>0)try{if(t.py+s>=e.hNum)return!1;if(t.px+a<0||t.px+a>e.wNum-1)return!1;if(this.list[t.py+s][t.px+a]>0)return!1}catch(h){console.log("sdf")}return!0},e.prototype.randomBox=function(){var t=Math.ceil(7*Math.random()),e=new ItemBox;e.init(t,1),e.refreshPos(3,0),this.boxContainer.addChild(e),this.check(e,e.list)?this.select=e:(alert("over:"+this.step+"步,"+this.score+"分"),this.stepTimer.stop()),this.step++,this.txtStep.text="step:"+this.step},e.prototype.updateList=function(t){for(var i=t.list,o=i.length,s=0;o>s;s++)for(var n=i[s],r=n.length,a=0;r>a;a++){var h=n[a];if(h){this.list[t.py+s][t.px+a]=h;var l=Global.createBitmapByName(t.type+"_"+h+"_png");l.anchorOffsetX=l.width>>1,l.anchorOffsetY=l.height>>1,l.x=(t.px+a)*e.size+(l.width>>1),l.y=(t.py+s)*e.size+(l.height>>1),l.rotation=t.icon.rotation,this.boxContainer.addChild(l),this.boxList[t.py+s+"_"+(t.px+a)]=l}}},e}(egret.DisplayObjectContainer);TetrisGame.maxW=500,TetrisGame.maxH=1e3,TetrisGame.wNum=10,TetrisGame.hNum=20,TetrisGame.size=50,__reflect(TetrisGame.prototype,"TetrisGame");var UIManager=function(t){function e(){var e=t.call(this)||this;return e.initLayer(),e}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e.prototype.initLayer=function(){this.mapLayer=new egret.DisplayObjectContainer,this.addChild(this.mapLayer),this.mainUILayer=new egret.DisplayObjectContainer,this.addChild(this.mainUILayer),this.popLayer=new egret.DisplayObjectContainer,this.addChild(this.popLayer),this.topLayer=new egret.DisplayObjectContainer,this.addChild(this.topLayer)},e.prototype.initMainView=function(){MapManager.instance,this.mainUILayer.addChild(new MainView)},e}(egret.DisplayObjectContainer);__reflect(UIManager.prototype,"UIManager");var UserInfo=function(){function t(){this.smallsow_url="https://kdt.im/SMjyNr",this.isShare=!1,this.isget=!1
}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t}();__reflect(UserInfo.prototype,"UserInfo");var CountData=function(){function t(){this.lastTime=0}return Object.defineProperty(t,"instance",{get:function(){return t._instance||(t._instance=new t),t._instance},enumerable:!0,configurable:!0}),t.prototype.init=function(t,e){this.ticket=e,t&&(t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.beginHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_MOVE,this.moveHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_END,this.endHandler,this),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.endHandler,this))},t.prototype.beginHandler=function(t){console.log("beginHandler"),this.isMove=!1,this.startX=t.stageX,this.startY=t.stageY},t.prototype.moveHandler=function(t){console.log("moveHandler"),this.isMove=!0},t.prototype.endHandler=function(t){console.log("endHandler");var e,i=t.stageX,o=t.stageY;if(this.isMove){var s=i-this.startX,n=o-this.startY;e=Math.abs(s)>Math.abs(n)?s>0?"right":"left":n>0?"down":"up",console.log("move:"+e)}else e="clilck",console.log("click");var r=egret.getTimer();if(!(r-this.lastTime<200)){this.lastTime=r;$.ajax({url:"http://123.59.156.230/lstat",data:{from:"H5",url:window.location.href,px:i,py:o,operation:e,ticket:this.ticket},success:function(t){},error:function(){console.log("error")},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&console.log("timeout")}})}},t}();__reflect(CountData.prototype,"CountData");var CustomImage=function(t){function e(e,i,o){void 0===i&&(i=!0),void 0===o&&(o=null);var s=t.call(this)||this;return s.url=e,s.isEase=i,s.compFunc=o,s.loadBg(),s}return __extends(e,t),e.prototype.loadBg=function(){RES.getResByUrl(this.url,this.onLoadComplete,this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.onLoadComplete=function(t){this.texture=t,this.isEase&&(this.alpha=0,egret.Tween.get(this).to({alpha:1},1e3)),this.compFunc&&this.compFunc()},e}(egret.Bitmap);__reflect(CustomImage.prototype,"CustomImage");var egret;!function(t){var e=function(e){function i(i){void 0===i&&(i=null);var o=e.call(this)||this;return o.scrollBeginThreshold=10,o.scrollSpeed=1,o._content=null,o.delayTouchBeginEvent=null,o.touchBeginTimer=null,o.touchEnabled=!0,o._ScrV_Props_=new t.ScrollViewProperties,i&&o.setContent(i),o}return __extends(i,e),Object.defineProperty(i.prototype,"bounces",{get:function(){return this._ScrV_Props_._bounces},set:function(t){this._ScrV_Props_._bounces=!!t},enumerable:!0,configurable:!0}),i.prototype.setContent=function(t){this._content!==t&&(this.removeContent(),t&&(this._content=t,e.prototype.addChild.call(this,t),this._addEvents()))},i.prototype.removeContent=function(){this._content&&(this._removeEvents(),e.prototype.removeChildAt.call(this,0)),this._content=null},Object.defineProperty(i.prototype,"verticalScrollPolicy",{get:function(){return this._ScrV_Props_._verticalScrollPolicy},set:function(t){t!=this._ScrV_Props_._verticalScrollPolicy&&(this._ScrV_Props_._verticalScrollPolicy=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"horizontalScrollPolicy",{get:function(){return this._ScrV_Props_._horizontalScrollPolicy},set:function(t){t!=this._ScrV_Props_._horizontalScrollPolicy&&(this._ScrV_Props_._horizontalScrollPolicy=t)},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scrollLeft",{get:function(){return this._ScrV_Props_._scrollLeft},set:function(t){t!=this._ScrV_Props_._scrollLeft&&(this._ScrV_Props_._scrollLeft=t,this._validatePosition(!1,!0),this._updateContentPosition())},enumerable:!0,configurable:!0}),Object.defineProperty(i.prototype,"scrollTop",{get:function(){return this._ScrV_Props_._scrollTop},set:function(t){t!=this._ScrV_Props_._scrollTop&&(this._ScrV_Props_._scrollTop=t,this._validatePosition(!0,!1),this._updateContentPosition())},enumerable:!0,configurable:!0}),i.prototype.setScrollPosition=function(t,e,i){if(void 0===i&&(i=!1),(!i||0!=t||0!=e)&&(i||this._ScrV_Props_._scrollTop!=t||this._ScrV_Props_._scrollLeft!=e)){var o=this._ScrV_Props_._scrollTop,s=this._ScrV_Props_._scrollLeft;if(i){var n=this.getMaxScrollLeft(),r=this.getMaxScrollTop();(0>=o||o>=r)&&(t/=2),(0>=s||s>=n)&&(e/=2);var a=o+t,h=s+e,l=this._ScrV_Props_._bounces;l||((0>=a||a>=r)&&(a=Math.max(0,Math.min(a,r))),(0>=h||h>=n)&&(h=Math.max(0,Math.min(h,n)))),this._ScrV_Props_._scrollTop=a,this._ScrV_Props_._scrollLeft=h}else this._ScrV_Props_._scrollTop=t,this._ScrV_Props_._scrollLeft=e;this._validatePosition(!0,!0),this._updateContentPosition()}},i.prototype._validatePosition=function(t,e){if(void 0===t&&(t=!1),void 0===e&&(e=!1),t){var i=this.height,o=this._getContentHeight();this._ScrV_Props_._scrollTop=Math.max(this._ScrV_Props_._scrollTop,(0-i)/2),this._ScrV_Props_._scrollTop=Math.min(this._ScrV_Props_._scrollTop,o>i?o-i/2:i/2)}if(e){var s=this.width,n=this._getContentWidth();this._ScrV_Props_._scrollLeft=Math.max(this._ScrV_Props_._scrollLeft,(0-s)/2),this._ScrV_Props_._scrollLeft=Math.min(this._ScrV_Props_._scrollLeft,n>s?n-s/2:s/2)}},i.prototype.$setWidth=function(t){if(this.$getExplicitWidth()==t)return!1;var i=e.prototype.$setWidth.call(this,t);return this._updateContentPosition(),i},i.prototype.$setHeight=function(t){if(this.$getExplicitHeight()==t)return!1;e.prototype.$setHeight.call(this,t);return this._updateContentPosition(),!0},i.prototype._updateContentPosition=function(){var e=this.height,i=this.width;this.scrollRect=new t.Rectangle(Math.round(this._ScrV_Props_._scrollLeft),Math.round(this._ScrV_Props_._scrollTop),i,e),this.dispatchEvent(new t.Event(t.Event.CHANGE))},i.prototype._checkScrollPolicy=function(){var t=this._ScrV_Props_._horizontalScrollPolicy,e=this.__checkScrollPolicy(t,this._getContentWidth(),this.width);this._ScrV_Props_._hCanScroll=e;var i=this._ScrV_Props_._verticalScrollPolicy,o=this.__checkScrollPolicy(i,this._getContentHeight(),this.height);return this._ScrV_Props_._vCanScroll=o,e||o},i.prototype.__checkScrollPolicy=function(t,e,i){return"on"==t?!0:"off"==t?!1:e>i},i.prototype._addEvents=function(){this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.addEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},i.prototype._removeEvents=function(){this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBegin,this),this.removeEventListener(t.TouchEvent.TOUCH_BEGIN,this._onTouchBeginCapture,this,!0),this.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEndCapture,this,!0)},i.prototype._onTouchBegin=function(e){if(!e.$isDefaultPrevented){var i=this._checkScrollPolicy();i&&(this._ScrV_Props_._touchStartPosition.x=e.stageX,this._ScrV_Props_._touchStartPosition.y=e.stageY,(this._ScrV_Props_._isHTweenPlaying||this._ScrV_Props_._isVTweenPlaying)&&this._onScrollFinished(),this._tempStage=this.stage,this._tempStage.addEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.addEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.addEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.addEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._logTouchEvent(e),e.preventDefault())}},i.prototype._onTouchBeginCapture=function(e){var i=this._checkScrollPolicy();if(i){for(var o=e.target;o!=this;){if("_checkScrollPolicy"in o&&(i=o._checkScrollPolicy()))return;o=o.parent}e.stopPropagation();var s=this.cloneTouchEvent(e);this.delayTouchBeginEvent=s,this.touchBeginTimer||(this.touchBeginTimer=new t.Timer(100,1),this.touchBeginTimer.addEventListener(t.TimerEvent.TIMER_COMPLETE,this._onTouchBeginTimer,this)),this.touchBeginTimer.start(),this._onTouchBegin(e)}},i.prototype._onTouchEndCapture=function(e){var i=this;if(this.delayTouchBeginEvent){this._onTouchBeginTimer(),e.stopPropagation();var o=this.cloneTouchEvent(e);t.callLater(function(){i.stage&&i.dispatchPropagationEvent(o)},this)}},i.prototype._onTouchBeginTimer=function(){this.touchBeginTimer.stop();var t=this.delayTouchBeginEvent;this.delayTouchBeginEvent=null,this.stage&&this.dispatchPropagationEvent(t)},i.prototype.dispatchPropagationEvent=function(e){for(var i=e.$target,o=this.$getPropagationList(i),s=o.length,n=.5*o.length,r=-1,a=0;s>a;a++)if(o[a]===this._content){r=a;break}o.splice(0,r+1),n-=r+1,this.$dispatchPropagationEvent(e,o,n),t.Event.release(e)},i.prototype._onTouchMove=function(t){if(this._ScrV_Props_._lastTouchPosition.x!=t.stageX||this._ScrV_Props_._lastTouchPosition.y!=t.stageY){if(!this._ScrV_Props_._scrollStarted){var e=t.stageX-this._ScrV_Props_._touchStartPosition.x,i=t.stageY-this._ScrV_Props_._touchStartPosition.y,o=Math.sqrt(e*e+i*i);if(o<this.scrollBeginThreshold)return void this._logTouchEvent(t)}this._ScrV_Props_._scrollStarted=!0,this.delayTouchBeginEvent&&(this.delayTouchBeginEvent=null,this.touchBeginTimer.stop()),this.touchChildren=!1;var s=this._getPointChange(t);this.setScrollPosition(s.y,s.x,!0),this._calcVelocitys(t),this._logTouchEvent(t)}},i.prototype._onTouchEnd=function(e){this.touchChildren=!0,this._ScrV_Props_._scrollStarted=!1,this._tempStage.removeEventListener(t.TouchEvent.TOUCH_MOVE,this._onTouchMove,this),this._tempStage.removeEventListener(t.TouchEvent.TOUCH_END,this._onTouchEnd,this),this._tempStage.removeEventListener(t.TouchEvent.LEAVE_STAGE,this._onTouchEnd,this),this.removeEventListener(t.Event.ENTER_FRAME,this._onEnterFrame,this),this._moveAfterTouchEnd()},i.prototype._onEnterFrame=function(e){var i=t.getTimer();i-this._ScrV_Props_._lastTouchTime>100&&i-this._ScrV_Props_._lastTouchTime<300&&this._calcVelocitys(this._ScrV_Props_._lastTouchEvent)},i.prototype._logTouchEvent=function(e){this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY,this._ScrV_Props_._lastTouchEvent=this.cloneTouchEvent(e),this._ScrV_Props_._lastTouchTime=t.getTimer()},i.prototype._getPointChange=function(t){return{x:this._ScrV_Props_._hCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.x-t.stageX,y:this._ScrV_Props_._vCanScroll===!1?0:this._ScrV_Props_._lastTouchPosition.y-t.stageY}},i.prototype._calcVelocitys=function(e){var i=t.getTimer();if(0==this._ScrV_Props_._lastTouchTime)return void(this._ScrV_Props_._lastTouchTime=i);var o=this._getPointChange(e),s=i-this._ScrV_Props_._lastTouchTime;o.x/=s,o.y/=s,this._ScrV_Props_._velocitys.push(o),this._ScrV_Props_._velocitys.length>5&&this._ScrV_Props_._velocitys.shift(),this._ScrV_Props_._lastTouchPosition.x=e.stageX,this._ScrV_Props_._lastTouchPosition.y=e.stageY},i.prototype._getContentWidth=function(){return this._content.$getExplicitWidth()||this._content.width},i.prototype._getContentHeight=function(){return this._content.$getExplicitHeight()||this._content.height},i.prototype.getMaxScrollLeft=function(){var t=this._getContentWidth()-this.width;return Math.max(0,t)},i.prototype.getMaxScrollTop=function(){var t=this._getContentHeight()-this.height;return Math.max(0,t)},i.prototype._moveAfterTouchEnd=function(){if(0!=this._ScrV_Props_._velocitys.length){for(var t={x:0,y:0},e=0,o=0;o<this._ScrV_Props_._velocitys.length;o++){var s=this._ScrV_Props_._velocitys[o],n=i.weight[o];t.x+=s.x*n,t.y+=s.y*n,e+=n}this._ScrV_Props_._velocitys.length=0,this.scrollSpeed<=0&&(this.scrollSpeed=1);var r=t.x/e*this.scrollSpeed,a=t.y/e*this.scrollSpeed,h=Math.abs(r),l=Math.abs(a),c=this.getMaxScrollLeft(),p=this.getMaxScrollTop(),d=h>.02?this.getAnimationDatas(r,this._ScrV_Props_._scrollLeft,c):{position:this._ScrV_Props_._scrollLeft,duration:1},u=l>.02?this.getAnimationDatas(a,this._ScrV_Props_._scrollTop,p):{position:this._ScrV_Props_._scrollTop,duration:1};this.setScrollLeft(d.position,d.duration),this.setScrollTop(u.position,u.duration)}},i.prototype.onTweenFinished=function(t){t==this._ScrV_Props_._vScrollTween&&(this._ScrV_Props_._isVTweenPlaying=!1),t==this._ScrV_Props_._hScrollTween&&(this._ScrV_Props_._isHTweenPlaying=!1),0==this._ScrV_Props_._isHTweenPlaying&&0==this._ScrV_Props_._isVTweenPlaying&&this._onScrollFinished()},i.prototype._onScrollStarted=function(){},i.prototype._onScrollFinished=function(){t.ScrollTween.removeTweens(this),this._ScrV_Props_._hScrollTween=null,this._ScrV_Props_._vScrollTween=null,this._ScrV_Props_._isHTweenPlaying=!1,this._ScrV_Props_._isVTweenPlaying=!1,this.dispatchEvent(new t.Event(t.Event.COMPLETE))},i.prototype.setScrollTop=function(e,i){void 0===i&&(i=0);var o=Math.min(this.getMaxScrollTop(),Math.max(e,0));if(0==i)return void(this.scrollTop=o);0==this._ScrV_Props_._bounces&&(e=o);var s=t.ScrollTween.get(this).to({scrollTop:e},i,t.ScrollEase.quartOut);o!=e&&s.to({scrollTop:o},300,t.ScrollEase.quintOut),this._ScrV_Props_._isVTweenPlaying=!0,this._ScrV_Props_._vScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isHTweenPlaying||this._onScrollStarted()},i.prototype.setScrollLeft=function(e,i){void 0===i&&(i=0);var o=Math.min(this.getMaxScrollLeft(),Math.max(e,0));if(0==i)return void(this.scrollLeft=o);0==this._ScrV_Props_._bounces&&(e=o);var s=t.ScrollTween.get(this).to({scrollLeft:e},i,t.ScrollEase.quartOut);o!=e&&s.to({scrollLeft:o},300,t.ScrollEase.quintOut),this._ScrV_Props_._isHTweenPlaying=!0,this._ScrV_Props_._hScrollTween=s,s.call(this.onTweenFinished,this,[s]),this._ScrV_Props_._isVTweenPlaying||this._onScrollStarted()},i.prototype.getAnimationDatas=function(t,e,i){var o=Math.abs(t),s=.95,n=0,r=.998,a=.02,h=e+500*t;if(0>h||h>i)for(h=e;Math.abs(t)!=1/0&&Math.abs(t)>a;)h+=t,t*=0>h||h>i?r*s:r,n++;else n=500*-Math.log(a/o);var l={position:Math.min(i+50,Math.max(h,-50)),duration:n};return l},i.prototype.cloneTouchEvent=function(e){var i=new t.TouchEvent(e.type,e.bubbles,e.cancelable);return i.touchPointID=e.touchPointID,i.$stageX=e.stageX,i.$stageY=e.stageY,i.touchDown=e.touchDown,i.$isDefaultPrevented=!1,i.$target=e.target,i},i.prototype.throwNotSupportedError=function(){t.$error(1023)},i.prototype.addChild=function(t){return this.throwNotSupportedError(),null},i.prototype.addChildAt=function(t,e){return this.throwNotSupportedError(),null},i.prototype.removeChild=function(t){return this.throwNotSupportedError(),null},i.prototype.removeChildAt=function(t){return this.throwNotSupportedError(),null},i.prototype.setChildIndex=function(t,e){this.throwNotSupportedError()},i.prototype.swapChildren=function(t,e){this.throwNotSupportedError()},i.prototype.swapChildrenAt=function(t,e){this.throwNotSupportedError()},i}(t.DisplayObjectContainer);e.weight=[1,1.33,1.66,2,2.33],t.CustomScrollView=e,__reflect(e.prototype,"egret.CustomScrollView")}(egret||(egret={}));var CustomTabbar=function(t){function e(e,i,o){for(var s=t.call(this)||this,n=0;e>n;n++){var r=Global.createBitmapByName("tabbar_"+(n+1)+"_2_png");r.x=295,r.y=115,s.addChild(r)}return s}return __extends(e,t),e}(egret.DisplayObjectContainer);__reflect(CustomTabbar.prototype,"CustomTabbar");var GameDispatcher=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}(egret.EventDispatcher);__reflect(GameDispatcher.prototype,"GameDispatcher");var Global=function(){function t(){}return t.createBitmapByRes=function(t,e){var i=new egret.Bitmap,o=RES.getRes(t);return console.log("name::"+e+"::"+t),i.texture=o.getTexture(e),i},t.createBitmapByName=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var o=new egret.Bitmap,s=RES.getRes(t);return o.texture=s,o.x=e,o.y=i,o},t.fadeIn=function(e,i,o,s){void 0===i&&(i=0),void 0===o&&(o=500),void 0===s&&(s=1),t.tweenFrom(e,i,o,0,0,s,egret.Ease.cubicOut)},t.fadeOut=function(e,i,o,s){void 0===i&&(i=0),void 0===o&&(o=500),void 0===s&&(s=1),t.tweenToHide(e,i,o,0,0,s,egret.Ease.cubicOut)},t.zoomIn=function(e,i,o,s){void 0===i&&(i=0),void 0===o&&(o=500),void 0===s&&(s=.6),t.tweenFrom(e,i,o,0,0,s,egret.Ease.backOut)},t.zoomOut=function(e,i,o,s){void 0===i&&(i=0),void 0===o&&(o=500),void 0===s&&(s=1.5),t.tweenToHide(e,i,o,0,0,s,egret.Ease.cubicIn)},t.tweenToHide=function(t,e,i,o,s,n,r,a){void 0===a&&(a=0);var h=egret.Tween.get(t),l=t.x,c=t.y;l+=o,c+=s,h.wait(e),h.to({alpha:a,scaleX:n,scaleY:n,x:l,y:c},i,r),h.call(function(){t.parent&&t.parent.removeChild(t)})},t.tweenTo=function(t,e,i,o,s,n,r,a){void 0===n&&(n=1),void 0===r&&(r=1),void 0===a&&(a=egret.Ease.cubicOut);var h=egret.Tween.get(t);h.wait(e),a?h.to({alpha:n,scaleX:r,scaleY:r,x:o,y:s},i,a):h.to({alpha:n,scaleX:r,scaleY:r,x:o,y:s},i)},t.tweenFrom=function(t,e,i,o,s,n,r){var a=egret.Tween.get(t),h=t.x,l=t.y;t.scaleX=t.scaleY=n,t.x=h+o,t.y=l+s,a.wait(e),a.to({alpha:1,scaleX:1,scaleY:1,x:h,y:l},i,r)},t.createMc=function(t,e,i){var o=RES.getRes(t),s=RES.getRes(e),n=new egret.MovieClipDataFactory(o,s),r=new egret.MovieClip(n.generateMovieClipData(i));return r},t.remove=function(t){t&&t.parent&&t.parent.removeChild(t)},t.setBut=function(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.alpha=.68},t),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.alpha=1},t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.alpha=1},t))},t.getArrayItems=function(t,e){var i=new Array;for(var o in t)i.push(t[o]);for(var s=new Array,n=0;e>n&&i.length>0;n++){var r=Math.floor(Math.random()*i.length);s[n]=i[r],i.splice(r,1)}return s},t.errorTips=function(t){t&&("invalidticket"==t.reason?PopManager.showPop("ErrorPop",ErrorCode.TICKET_TIME_OUT):"invalidticketparam"==t.reason?PopManager.showPop("ErrorPop",ErrorCode.NOT_FOUND):PopManager.showPop("ErrorPop",ErrorCode.SYSTEM_ERROR))},t.showTips=function(t){Message.show(t)},t.getClass=function(t){if(t&&t.constructor){var e=t.constructor.toString(),i=e.substr(0,e.indexOf("("));return i=i.replace("function",""),i.replace(/(^\s*)|(\s*$)/gi,"")}return typeof t},t}();Global.grayMatrix=[.3,.6,0,0,0,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0],Global.grayFlilter=[new egret.ColorMatrixFilter(Global.grayMatrix)],Global.grayFlilter1=[new egret.ColorMatrixFilter([.3,.6,0,0,200,.3,.6,0,0,0,.3,.6,0,0,0,0,0,0,1,0])],__reflect(Global.prototype,"Global");var Message=function(t){function e(){var e=t.call(this)||this;return e.bg=Global.createBitmapByName("message_bg_png"),e.bg.y=-10,e.addChild(e.bg),e.txtStr=new egret.TextField,e.txtStr.width=StageUtils.SW,e.txtStr.textAlign=egret.HorizontalAlign.CENTER,e.addChild(e.txtStr),e}return __extends(e,t),e.prototype.show=function(t){this.txtStr.text=t,this.bg.width=this.txtStr.textWidth+50,this.bg.height=this.txtStr.textHeight+20,this.bg.x=StageUtils.SW-this.bg.width>>1,this.y=StageUtils.SH>>1,this.alpha=1,egret.Tween.get(this).wait(1e3).to({y:this.y-100,alpha:0},1e3,egret.Ease.quadIn).call(this.tweenEnd,this)},e.prototype.tweenEnd=function(){this.parent&&(this.parent.removeChild(this),e.pool.push(this))},e.show=function(t){var i;i=e.pool.length>0?e.pool.pop():new e,i&&(i.show(t),UIManager.instance.popLayer.addChild(i))},e}(egret.DisplayObjectContainer);Message.pool=[],__reflect(Message.prototype,"Message");var QRCode=function(){function t(t){var e=document.getElementById("gameDiv");this.htmlCode=document.createElement("img"),this.htmlCode.src=t,this.htmlCode.style.position="absolute",this.htmlCode.style.display="none",e.appendChild(this.htmlCode)}return t.prototype.showHtmlCode=function(){this.htmlCode&&(this.htmlCode.style.display="inline")},t.prototype.hideHtmlCode=function(){this.htmlCode&&(this.htmlCode.style.display="none")},t.prototype.setPosition=function(t,e,i,o){if(null!=this.htmlCode)if(document.body.clientWidth<document.body.clientHeight){var s=document.body.clientWidth/StageUtils.SW,n=document.body.clientHeight/StageUtils.SH;this.htmlCode.style.width=i*s+"px",this.htmlCode.style.height=o*n+"px",this.htmlCode.style.left=t*s+"px",this.htmlCode.style.top=e*n+"px"}else{var s=document.body.clientWidth/StageUtils.SH,n=document.body.clientHeight/StageUtils.SW;this.htmlCode.style.width=o*s+"px",this.htmlCode.style.height=i*n+"px",this.htmlCode.style.top=(StageUtils.SH-t-i)*n+"px",this.htmlCode.style.left=e*s+"px"}},t.prototype.destroy=function(){this.htmlCode&&(this.htmlCode.parentNode.removeChild(this.htmlCode),this.htmlCode=null)},t}();__reflect(QRCode.prototype,"QRCode");var StageUtils=function(){function t(){}return t.registStage=function(e){t.stage=e,t.SW=e.stageWidth,t.SH=e.stageHeight,t.CW=t.SW>>1,t.CH=t.SH>>1,t.LW=window.innerWidth,t.LH=window.innerHeight},t.centerInParentX=function(e,i){void 0===i&&(i=null),e&&(i?e.x=i.width-e.width>>1:e.x=t.stage.stageWidth-e.width>>1)},t.centerInParentY=function(e,i){void 0===i&&(i=null),e&&(i?e.y=i.height-e.height>>1:e.y=t.stage.stageHeight-e.height>>1)},t.centerInParent=function(e,i,o,s){void 0===i&&(i=0),void 0===o&&(o=0),void 0===s&&(s=null),e&&(s?(e.x=(s.width-e.width>>1)+i,e.y=(s.height-e.height>>1)+o):(e.x=(t.stage.stageWidth-e.width>>1)+i,e.y=(t.stage.stageHeight-e.height>>1)+o))},t}();__reflect(StageUtils.prototype,"StageUtils");var ErrorPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){void 0===t&&(t=1);var e="";1==t?e="resource/assets/error/is_get.png":2==t?e="resource/assets/error/error_web.png":3==t&&(e="resource/assets/error/error_code.png");var i=new CustomImage(e,!0,function(){i.x=StageUtils.SW-i.width>>1,i.y=(StageUtils.SH-i.height>>1)-100});this.addChild(i)},e}(PopView);__reflect(ErrorPop.prototype,"ErrorPop");var GuanZhuPop=function(t){function e(){var e=t.call(this)||this;return e.state=0,e}return __extends(e,t),e.prototype.setData=function(t){void 0===t&&(t=null),this.data=t,this.removeChildren();var e=Global.createBitmapByName("pop_bg_png");e.x=StageUtils.SW-e.width>>1,e.y=StageUtils.SH-e.height>>1,this.addChild(e);var i=Global.createBitmapByName("guanzhu_bg_png");i.x=StageUtils.SW-i.width>>1,i.y=StageUtils.SH-i.height>>1,this.addChild(i);var o=Global.createBitmapByName("btn_get_zhidao_png");o.x=StageUtils.SW-o.width>>1,o.y=750,this.addChild(o),o.touchEnabled=!0,Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okClickHandler,this),this.code=new QRCode("resource/assets/asyn/guanzhu_code.png"),this.code.setPosition(StageUtils.SW-206>>1,(StageUtils.SH-206>>1)+20,206,206),this.code.showHtmlCode()},e.prototype.okClickHandler=function(){this.code.hideHtmlCode(),PopManager.hidePop("GuanZhuPop")},e}(PopView);__reflect(GuanZhuPop.prototype,"GuanZhuPop");var HbPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this);var i=Global.createBitmapByName("hb_light_png");i.x=StageUtils.CW,i.y=StageUtils.CH,i.anchorOffsetX=i.width>>1,i.anchorOffsetY=i.height>>1,this.addChild(i),egret.Tween.get(i).to({rotation:3600},8e4);var o=Global.createBitmapByName("bg_btn_png");o.x=StageUtils.SW-o.width>>1,o.y=StageUtils.SH-o.height>>1,this.addChild(o),Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){egret.Tween.removeTweens(i),PopManager.hidePop("HbPop"),PopManager.showPop("RewardPop",{val:100,desc:"hb"})},this);var s=Global.createMc("loading_json","loading_png","");s.play(),s.x=0,s.y=0,this.addChild(s)},e}(PopView);__reflect(HbPop.prototype,"HbPop");var HelpPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(e){void 0===e&&(e=null),t.prototype.setData.call(this,e);var i=new CustomImage("resource/assets/asyn/action_bg.png",!0,function(){i.x=StageUtils.SW-i.width>>1,i.y=StageUtils.SH-i.height>>1});this.addChild(i);var o=new egret.ScrollView;o.width=473,o.height=700,o.y=150,this.addChild(o);var s=new CustomImage("resource/assets/asyn/action.png",!0,function(){o.setContent(s),o.x=StageUtils.SW-s.width>>1}),n=Global.createBitmapByName("btn_up_png");n.x=StageUtils.SW-n.width>>1,n.y=StageUtils.SH-160,this.addChild(n);var r=Global.createBitmapByName("close_png");r.x=545,r.y=110,this.addChild(r),Global.setBut(r),r.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this)},e.prototype.closeHandler=function(){PopManager.hidePop("HelpPop")},e}(PopView);__reflect(HelpPop.prototype,"HelpPop");var ShopItemView=function(_super){function ShopItemView(t){var e=_super.call(this)||this;return e.obj=t,e.id=t.shopid,e.status=t.ticket,e.type=t.type,e.init(),console.log("id:"+e.id),e}return __extends(ShopItemView,_super),ShopItemView.prototype.init=function(){this.icon=Global.createBitmapByName("icon"+this.id+"_png"),this.icon.x=-this.icon.width>>1,this.icon.y=-this.icon.height,this.addChild(this.icon)},ShopItemView.prototype.refreshPos=function(){if(this.obj&&MapManager.instance.Gmap){var p=eval("MapManager.instance.Gmap.pointToPixel(new BMap.Point("+this.obj.lng+","+this.obj.lat+"))");this.x=p.x*(StageUtils.SW/StageUtils.LW),this.y=p.y*(StageUtils.SH/StageUtils.LH),console.log(p.x,p.y,this.x,this.y)}},ShopItemView}(egret.DisplayObjectContainer);__reflect(ShopItemView.prototype,"ShopItemView");var MainView=function(_super){function MainView(){var t=_super.call(this)||this;return t.isFirst=!0,t.posX=[280,530,130,150,520],t.posY=[800,300,750,500,670],t.shopList={},MainView.instance=t,t.initView(),console.log(t.__typeof__(t)),console.log(typeof t),t}return __extends(MainView,_super),MainView.prototype.__typeof__=function(t){if(t&&t.constructor){var e=t.constructor.toString(),i=e.substr(0,e.indexOf("("));return i=i.replace("function",""),i.replace(/(^\s*)|(\s*$)/gi,"")}return typeof t},MainView.prototype.loadHead=function(){var t=new CustomImage(UserInfo.instance.url,!0,function(){t.width=100,t.height=100});t.x=0,t.y=20,this.addChild(t);var e=Global.createBitmapByName("head_bg_png");e.x=0,e.y=20,this.addChild(e);var i=new egret.Shape;i.graphics.beginFill(0),i.graphics.drawCircle(t.x+54,t.y+45,40),i.graphics.drawCircle,i.graphics.endFill(),this.addChild(i),t.mask=i},MainView.prototype.initView=function(){var t=Global.createBitmapByName("head_png");t.x=0,t.y=0,this.addChild(t),this.txtName=new egret.TextField,this.txtName.textColor=5900950,this.txtName.size=20,this.txtName.text=UserInfo.instance.username,this.txtName.width=400,this.txtName.x=100,this.txtName.y=28,this.txtName.text="",this.addChild(this.txtName),this.shopContainer=new egret.DisplayObjectContainer,this.addChild(this.shopContainer);var e=Global.createBitmapByName("out_bg_png");e.x=0,e.y=StageUtils.SH-e.height,this.addChild(e),this.initGuanZhu()},MainView.prototype.showInfo=function(){this.loadHead(),this.txtName.text=UserInfo.instance.username+""},MainView.prototype.initSmallShop=function(){var t=new ShopItemView({shopid:3});t.x=520,t.y=670,t.oy=t.y,this.shopContainer.addChild(t),Global.setBut(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){UserInfo.instance.isget?PopManager.showPop("SmallShopPop1"):PopManager.showPop("SmallShopPop")},this)},MainView.prototype.initGuanZhu=function(){var t=Global.createBitmapByName("btn_add_png");t.x=480,t.y=23,this.addChild(t),Global.setBut(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopManager.showPop("GuanZhuPop")},this);var e=Global.createBitmapByName("btn_active_png");e.x=480,e.y=80,this.addChild(e),Global.setBut(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopManager.showPop("HelpPop")},this)},MainView.prototype.addTouchHandler=function(){},MainView.prototype.showPingZi=function(){this.pingzi=Global.createMc("pingzi_json","pingzi_png",""),this.pingzi.frameRate=12,this.pingzi.play(-1),this.addChild(this.pingzi),this.showPingZiEffect()},MainView.prototype.showPingZiEffect=function(){var t=this;this.pingzi&&egret.Tween.get(this.pingzi,{loop:!0}).wait(200).call(function(){var e=Math.floor(100*Math.random()-50),i=Math.floor(100*Math.random()-50);e>0?t.pingzi.x+e>StageUtils.SW-180&&(e=0):t.pingzi.x+e<180&&(e=0),i>0?t.pingzi.y+i>StageUtils.SH-240&&(e=0):t.pingzi.y+i<240&&(e=0),e+=t.pingzi.x,i+=t.pingzi.y,180>e?e=180:e>StageUtils.SW-180&&(e=StageUtils.SW-180),240>i?i=240:i>StageUtils.SH-240&&(i=StageUtils.SH-240),egret.Tween.get(t.pingzi).to({x:e,y:i},200)})},MainView.prototype.showBox=function(){var t=Global.createBitmapByName("icon1_png");t.x=400,t.y=200,this.addChild(t),Global.setBut(t),t.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boxClickHandler,this);var e=Global.createBitmapByName("icon1_png");e.x=50,e.y=500,this.addChild(e),Global.setBut(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boxClickHandler,this);var i=Global.createBitmapByName("icon1_png");i.x=200,i.y=700,this.addChild(i),Global.setBut(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.boxClickHandler,this),this.box1=t,this.box2=e,this.box3=i},MainView.prototype.boxClickHandler=function(t){var e=this;if(this.isFirst){this.isFirst=!1;var i=t.target;egret.Tween.removeTweens(this.pingzi),egret.Tween.get(this.pingzi).to({x:t.target.x,y:t.target.y+100},500).to({y:t.target.y+150},100).to({y:t.target.y+100},100).to({y:t.target.y+150},100).to({y:t.target.y+100},100).to({y:t.target.y+150},100).to({y:t.target.y+100},100).call(function(){egret.Tween.get(i).to({x:i.x+10},50).to({x:i.x},50).to({x:i.x+10},50).to({x:i.x},50).to({x:i.x+10},50).to({x:i.x},50).call(function(){e.play()})})}},MainView.prototype.play=function(){this.showPingZiEffect(),this.box1&&(this.removeChild(this.box1),this.box1=null),this.box2&&(this.removeChild(this.box2),this.box2=null),this.box3&&(this.removeChild(this.box3),this.box3=null);var t=sessionStorage.getItem("ticket");console.log(t),void 0!=t&&$.ajax({url:MapManager.PLAY_API,data:{ticket:t},success:function(t){console.log(t),"success"==t.result?"cash"==t.prizes[0].type?PopManager.showPop("RewardPop",{val:t.prizes[0].desc,ticket:t.prizes[0].ticket}):window.location.href=t.prizes[0].value:PopManager.showPop("ErrorPop",2)},error:function(t){Message.show("error")},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Message.show("timeout")}})},MainView.prototype.hbClickHandler=function(){$.ajax({url:MapManager.PLAY_API,data:{ticket:MapManager.PLAY_TICKET},success:function(t){"success"==t.result&&"success"==t.more.result?PopManager.showPop("RewardPop",t.more):PopManager.showPop("ErrorPop",2)},error:function(){},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){}})},MainView.prototype.showShop=function(t){if(t)for(var e=t.length,i=0;e>i;i++){var o=t[i];if(o){o.shopid=4;var s=new ShopItemView(o);this.shopContainer.addChild(s),this.shopList[o.shopid]=s,s.touchEnabled=!0,s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.shopClickHandler,this),Global.setBut(s),s.refreshPos()}}this.container&&this.container.parent&&this.removeChild(this.container),this.container=null},MainView.prototype.shopClickHandler=function(t){PopManager.showPop("ShopPop",t.target.obj)},MainView.prototype.getReward=function(id,kq){void 0===kq&&(kq=0);var self=this,iswin=1;10==id&&(id=0,iswin=0);var dat;dat=kq?{ticket:MapManager.USER_TICKET,isshared:MapManager.isShared,shopid:id,iswin:iswin,kq:1}:{ticket:MapManager.USER_TICKET,isshared:MapManager.isShared,shopid:id,iswin:iswin},$.ajax({url:MapManager.PLAY_API,data:dat,success:function(data){if(0==data.result||"success"==data.result)if("0"==data.shopid||"10"==data.shopid)PopManager.showPop("LanternResultPop",data);else if(data.kq&&data.kq1)PopManager.showPop("RewardPop",data);else if(data.kq){var addcard=eval("$.addCard");addcard(this,data.signs,function(){console.log("领取成功"),self.getReward(1,1)},function(){console.log("领取失败")})}else PopManager.showPop("RewardPop",data);else 6==data.result?Message.show("领取失败，请重新领取"):2==data.result?Message.show("分享数量达到上限"):3==data.result?Message.show("已经领取过"):Message.show("系统异常:"+data.result)},error:function(){},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){}})},MainView}(egret.DisplayObjectContainer);__reflect(MainView.prototype,"MainView");var ReceivedPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(){var t=Global.createBitmapByName("pop_bg_png");t.x=StageUtils.SW-t.width>>1,t.y=StageUtils.SH-t.height>>1,this.addChild(t);
var e=Global.createBitmapByName("received_bg_png");e.x=StageUtils.SW-e.width>>1,e.y=(StageUtils.SH-e.height>>1)-80,this.addChild(e);var i=Global.createBitmapByName("btn_into_shop_png");i.x=StageUtils.SW-i.width>>1,i.y=(StageUtils.SH-i.height>>1)+220,this.addChild(i),Global.setBut(i),i.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this);var o=Global.createBitmapByName("close_png");o.x=540,o.y=160,this.addChild(o),Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler1,this)},e.prototype.closeHandler1=function(){PopManager.hidePop("ReceivedPop")},e.prototype.closeHandler=function(){window.location.href=UserInfo.instance.smallsow_url},e}(PopView);__reflect(ReceivedPop.prototype,"ReceivedPop");var RewardPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(t){var e=this;void 0===t&&(t=null),this.data=t;var i=Global.createBitmapByName("pop_bg_png");i.x=StageUtils.SW-i.width>>1,i.y=StageUtils.SH-i.height>>1,this.addChild(i),this.container=new egret.DisplayObjectContainer,this.addChild(this.container);var o=new CustomImage("resource/assets/reward/"+t.prizes[0].desc+".png",!0,function(){o.x=StageUtils.SW-o.width>>1,o.y=(StageUtils.SH-o.height>>1)-50});this.container.addChild(o);var s;s="cash"==t.prizes[0].pooltype?"btn_get_hb_png":"btn_get_ok_png";var n=Global.createBitmapByName(s);n.x=StageUtils.SW-n.width>>1,n.y=745,this.container.addChild(n),Global.setBut(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"cash"==t.prizes[0].pooltype?e.getHB():e.getOther()},this)},e.prototype.getHB=function(){var t=this;$.ajax({url:MapManager.PLAY_API,data:{ticket:this.data.prizes[0].ticket},success:function(e){if("success"==e.result){t.container.removeChildren();var i=new CustomImage("resource/assets/asyn/get_hb_ok.png",!0,function(){i.x=StageUtils.SW-i.width>>1,i.y=(StageUtils.SH-i.height>>1)-50});t.container.addChild(i);var o=Global.createBitmapByName("btn_share_png");o.x=StageUtils.SW-o.width>>1,o.y=745,t.container.addChild(o),Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){PopManager.hidePop("RewardPop"),PopManager.showPop("SharePop")},t)}else PopManager.showPop("ErrorPop",2)},error:function(){Message.show("error")},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Message.show("timeout")}})},e.prototype.getOther=function(){var t=this;this.container.removeChildren();var e=new CustomImage("resource/assets/asyn/other_bg.png",!0,function(){e.x=StageUtils.SW-e.width>>1,e.y=(StageUtils.SH-e.height>>1)-50});this.container.addChild(e);var i=new egret.TextField;i.type=egret.TextFieldType.INPUT,i.x=230,i.y=375,i.width=280,i.maxChars=20,this.addChild(i);var o=new egret.TextField;o.type=egret.TextFieldType.INPUT,o.x=230,o.y=445,o.width=280,o.maxChars=11,o.restrict="0-9",o.inputType=egret.TextFieldInputType.TEL,this.addChild(o);var s=new egret.TextField;s.type=egret.TextFieldType.INPUT,s.x=150,s.y=565,s.width=350,s.height=60,s.multiline=!0,s.maxChars=100,this.addChild(s);var n=Global.createBitmapByName("btn_submit_png");n.x=StageUtils.SW-n.width>>1,n.y=745,this.container.addChild(n),Global.setBut(n),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){var e=i.text.trim(),n=o.text.trim(),r=s.text.trim();e?n&&11==n.length?r?t.play(e,n,r):Message.show("请输入地址!"):Message.show("请输入手机号!"):Message.show("请输入姓名!")},this),MapManager.instance.share(1)},e.prototype.play=function(t,e,i){$.ajax({url:MapManager.PLAY_API,data:{ticket:this.data.ticket,name:t,telephone:e,address:i},success:function(t){"success"==t.result&&"success"==t.more.result?(PopManager.hidePop("RewardPop"),PopManager.showPop("SharePop")):PopManager.showPop("ErrorPop",2)},error:function(){Message.show("error")},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Message.show("timeout")}})},e.prototype.closeClickHandler=function(){"cash"==this.data.prizes[0].type?PopManager.hidePop("RewardPop"):window.location.href=this.data.prizes[0].value},e.prototype.closeClickHandler1=function(){PopManager.hidePop("RewardPop")},e.prototype.showGetReward=function(){var t=new CustomImage("resource/assets/reward/get_reward_ok.png",!0,function(){t.x=StageUtils.SW-t.width>>1,t.y=StageUtils.SH-t.height>>1});this.container.addChild(t);var e=Global.createBitmapByName("btn_guanzhu_png");e.x=StageUtils.SW-e.width>>1,e.y=756,this.container.addChild(e),Global.setBut(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){},this)},e}(PopView);__reflect(RewardPop.prototype,"RewardPop");var ShareIntoPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(){UIManager.instance.popLayer.addChild(this),this.touchEnabled=!0},e.prototype.setData=function(e){t.prototype.setData.call(this,e);var i=new CustomImage("resource/assets/asyn/share_bg.jpg",!0,function(){i.width=StageUtils.SW,i.height=StageUtils.SH});this.addChild(i);var o=new CustomImage(e.url,!0,function(){o.width=130,o.height=130});o.x=StageUtils.CW-65,o.y=250,this.addChild(o);var s=Global.createBitmapByName("head_bg_png");s.x=0,s.y=20,this.addChild(s);var n=new egret.Shape;n.graphics.beginFill(0),n.graphics.drawCircle(o.x+65,o.y+65,65),n.graphics.drawCircle,n.graphics.endFill(),this.addChild(n),o.mask=n;var r=new egret.TextField;r.text=decodeURI(e.username)+"",r.width=StageUtils.SW,r.textAlign="center",r.x=0,r.y=400,r.textColor=16773120,this.addChild(r);var a="";a=1==e.isget?"resource/assets/asyn/share_phone.png":"resource/assets/asyn/share_other.png";var h=new CustomImage(a,!0,function(){h.x=StageUtils.SW-h.width>>1,h.y=StageUtils.SH-550});this.addChild(h);var l=new CustomImage("resource/assets/main/btn_buy.png",!0,function(){l.x=StageUtils.SW-l.width>>1,l.y=StageUtils.SH-300});this.addChild(l),Global.setBut(l),l.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},e.prototype.touchHandler=function(){window.location.href=UserInfo.instance.smallsow_url},e}(PopView);__reflect(ShareIntoPop.prototype,"ShareIntoPop");var SharePop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(){var t=new egret.Shape;t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,StageUtils.stage.stageWidth,StageUtils.stage.stageHeight),t.graphics.endFill(),this.addChildAt(t,0),UIManager.instance.popLayer.addChild(this),this.touchEnabled=!0;var e=new CustomImage("resource/assets/asyn/share_bg.png",!0,function(){e.x=StageUtils.SW-e.width-35,e.y=35});this.addChild(e)},e}(PopView);__reflect(SharePop.prototype,"SharePop");var ShopPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.show=function(){new egret.Shape;UIManager.instance.popLayer.addChild(this),this.touchEnabled=!0},e.prototype.setData=function(e){t.prototype.setData.call(this,e),this.removeChildren();var i=Global.createBitmapByName("shop_bg_png");i.width=StageUtils.SW,this.addChild(i);var o=Global.createBitmapByName("shop_icon_png");o.x=60,o.y=85,this.addChild(o);var s=new egret.TextField;s.x=60,s.y=40,s.bold=!0,this.addChild(s),s.text=decodeURI(e.name)+"";var n=new egret.TextField;n.x=90,n.y=84,this.addChild(n),n.size=24,n.text=decodeURI(e.address)+"",this.y=StageUtils.SH,egret.Tween.get(this).to({y:StageUtils.SH-i.height},300),this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this)},e.prototype.touchHandler=function(){PopManager.hidePop("ShopPop")},e}(PopView);__reflect(ShopPop.prototype,"ShopPop");var SmallShopPop=function(t){function e(){var e=t.call(this)||this;return e.state=0,e}return __extends(e,t),e.prototype.setData=function(t){void 0===t&&(t=null),this.data=t,this.removeChildren();var e=Global.createBitmapByName("pop_bg_png");e.x=StageUtils.SW-e.width>>1,e.y=StageUtils.SH-e.height>>1,this.addChild(e);var i=new CustomImage("resource/assets/asyn/smallsow_bg.png",!0,function(){i.x=(StageUtils.SW-i.width>>1)+10,i.y=(StageUtils.SH-i.height>>1)-100});this.addChild(i);var o=Global.createBitmapByName("btn_return_png");o.x=StageUtils.SW-o.width>>1,o.y=600,this.addChild(o),o.touchEnabled=!0,Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.returnClickHandler,this);var s=Global.createBitmapByName("btn_into_shop_png");s.x=StageUtils.SW-s.width>>1,s.y=718,this.addChild(s),s.touchEnabled=!0,Global.setBut(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.okClickHandler,this)},e.prototype.okClickHandler=function(){window.location.href=UserInfo.instance.smallsow_url},e.prototype.returnClickHandler=function(){PopManager.hidePop("SmallShopPop")},e}(PopView);__reflect(SmallShopPop.prototype,"SmallShopPop");var SmallShopPop1=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(e){t.prototype.setData.call(this,e);var i=new CustomImage("resource/assets/asyn/shop_bg.png",!0,function(){i.x=StageUtils.SW-i.width>>1,i.y=StageUtils.SH-i.height>>1});this.addChild(i);var o=Global.createBitmapByName("btn_into_shop_png");o.x=StageUtils.SW-o.width>>1,o.y=StageUtils.SH-300,this.addChild(o),Global.setBut(o),o.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this);var s=Global.createBitmapByName("close_png");s.x=540,s.y=160,this.addChild(s),Global.setBut(s),s.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler1,this)},e.prototype.closeHandler1=function(){PopManager.hidePop("SmallShopPop1")},e.prototype.touchHandler=function(){window.location.href=UserInfo.instance.smallsow_url},e}(PopView);__reflect(SmallShopPop1.prototype,"SmallShopPop1");var TipsPop=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.setData=function(){var t=Global.createBitmapByName("tips_bg_png");t.x=StageUtils.SW-t.width>>1,t.y=StageUtils.SH-t.height>>1,this.addChild(t);var e=Global.createBitmapByName("close_png");e.x=StageUtils.SW-80,e.y=(StageUtils.SH-e.height>>1)-205,this.addChild(e),Global.setBut(e),e.addEventListener(egret.TouchEvent.TOUCH_TAP,this.closeHandler,this)},e.prototype.closeHandler=function(){PopManager.hidePop("TipsPop")},e}(PopView);__reflect(TipsPop.prototype,"TipsPop");
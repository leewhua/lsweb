var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},End=function(_super){function End(){var t=_super.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(End,_super),End.prototype.onAddToStage=function(event){var over=new egret.Shape,win=Main.createBitmapByName("w"+Main.win+"_png");over.graphics.beginFill(0,.8),over.graphics.drawRect(0,0,640,1030);var overBg=Main.createBitmapByName("over-bg_png");overBg.x=this.stage.width-overBg.width>>1,overBg.y=34;var but=Main.createBitmapByName("btn-hb_png"),btn_q=Main.createBitmapByName("btn-q_png"),tips_hb=Main.createBitmapByName("tips-hb_png");tips_hb.x=this.stage.width-tips_hb.width>>1,tips_hb.y=540,btn_q.x=(640-but.width)/2,btn_q.y=875;var tips_q=Main.createBitmapByName("tips-q_png");tips_q.x=this.stage.width-tips_q.width>>1,tips_q.y=540;var guangSp=new egret.Sprite,winSp=new egret.Sprite;guangSp.x=320,guangSp.y=505,win.height=win.height*Main.scale,win.x=-win.width/2,win.y=win.height/-2-6,winSp.addChild(win),winSp.x=320,winSp.y=410,but.x=(640-but.width)/2,but.y=880,this.addChild(over),this.addChild(overBg),this.addChild(guangSp),this.addChild(winSp),Main.win<3?(this.addChild(but),this.addChild(tips_hb)):(this.addChild(btn_q),this.addChild(tips_q)),over.alpha=0,guangSp.alpha=0,winSp.alpha=0,winSp.scaleX=winSp.scaleY=.6,but.alpha=0;var tw=egret.Tween.get(over);tw.to({alpha:1},300);var tw=egret.Tween.get(guangSp);tw.wait(100).to({alpha:1},300);var tw=egret.Tween.get(winSp);tw.wait(200).to({alpha:1,scaleX:1,scaleY:1},300,egret.Ease.backOut);var tw=egret.Tween.get(but);tw.wait(300).to({alpha:1},300),Main.setBut(but),but.touchEnabled=!0,but.addEventListener(egret.TouchEvent.TOUCH_TAP,function(event){if(this.parent){var weixin=eval("wx");weixin&&weixin.closeWindow()}},this),btn_q.touchEnabled=!0,btn_q.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){$.ajax({url:Main.api,data:{ticket:Main.oid},error:function(){Main.showLost("出现错误，请稍后尝试")},success:function(t){if(console.log(t),"success"==t.result){var e=(t.prize.value.length,window.wx);e&&e.addCard({cardList:t.prize.value,success:function(t){},fail:function(t){}})}else t.error_code?Main.showLost(t.error):Main.showLost("出现错误，请稍后尝试")},dataType:"json",async:!0,type:"POST"})},this),setInterval(function(){guangSp.rotation+=2},100)},End}(egret.Sprite);__reflect(End.prototype,"End");var Help=function(t){function e(){var e=t.call(this)||this;return e.initView(),e}return __extends(e,t),e.prototype.initView=function(){var t=new egret.Shape;t.graphics.beginFill(0,.68),t.graphics.drawRect(0,0,640,1010);var e=Main.createBitmapByName("close-help_png"),i=Main.createBitmapByName("help-copy_png");i.x=68,i.y=220,e.x=236,e.y=645,this.addChild(t),this.addChild(i),this.addChild(e),Main.setBut(e);var n=this;this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){n.parent&&n.parent.removeChild(n)},this)},e}(egret.Sprite);__reflect(Help.prototype,"Help");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.createView(),e}return __extends(e,t),e.prototype.createView=function(){this.textField=new egret.TextField,this.addChild(this.textField),this.textField.y=500,this.textField.width=600,this.textField.height=100,this.textField.textColor=6710886,this.textField.textAlign="center",this.textField.text="Loading..."},e.prototype.setProgress=function(t,e){this.textField.text="加载..."+t+"/"+e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(_super){function Main(){var t=_super.call(this)||this;return t.count=0,t.loaded=0,Main._main=t,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(Main,_super),Main.prototype.onAddToStage=function(t){var e=window.innerWidth/640,i=window.innerHeight/1030;if(Main.scale=e/i,console.log(Main.scale),this.stage.scaleMode=egret.StageScaleMode.EXACT_FIT,Main.isTest||this.getData()){this.loadUser()}else Main.showLost("没有用户信息，请返回。")},Main.getQueryString=function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?decodeURIComponent(i[2]):null},Main.prototype.loadConfig=function(){console.log("loadConfig"),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/config.json","resource/")},Main.prototype.showScene=function(){console.log("showScene"),this.scene=new Scene,this.stage.addChildAt(this.scene,0)},Main.prototype.clearOld=function(){this.old&&this.old.parent&&this.removeChild(this.old),this.old=null},Main.prototype.onConfigComplete=function(t){console.log("onConfigComplete"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),this.loadingView=new LoadingUI,this.stage.addChild(this.loadingView),RES.loadGroup("sc")},Main.prototype.onResourceLoadComplete=function(t){console.log("onResourceLoadComplete:"+t.groupName),this.scene=Scene.instance,this.stage.addChildAt(Scene._scene,0),this.stage.removeChild(this.loadingView)},Main.createBitmapByRes=function(t,e){var i=new egret.Bitmap,n=RES.getRes(t);return console.log("name::"+e+"::"+t),i.texture=n.getTexture(e),i},Main.createBitmapByName=function(t){var e=new egret.Bitmap,i=RES.getRes(t);return e.texture=i,e},Main.tweenTo=function(t,e,i,n,a,s,o){var r=egret.Tween.get(t),h=t.x,p=t.y,c=t.width,l=t.height;t.scaleX=t.scaleY=s,t.x=h+n+(1-s)/2*c,t.y=p+a+(1-s)/2*l,r.wait(e),r.to({alpha:1,scaleX:1,scaleY:1,x:h,y:p},i,o)},Main.createMc=function(t,e,i){var n=RES.getRes(t),a=RES.getRes(e),s=new egret.MovieClipDataFactory(n,a),o=new egret.MovieClip(s.generateMovieClipData(i));return o},Main.setBut=function(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.alpha=.68},t),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.alpha=1},t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.alpha=1},t))},Main.prototype.onResourceLoadError=function(t){this.onResourceLoadComplete(t)},Main.prototype.onResourceProgress=function(t){this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},Main.prototype.getData=function(){var t=window.location.href.split("#")[0].split("?")[1].substring(0,32);return console.log("loadUser"),console.log(t),Main.ticket=t,Main.isTest||""!=Main.ticket?!0:!1},Main.prototype.loadUser=function(){var self=this;if(console.log("loadUser",Main.userApi),Main.isTest)return Main.user.name="test",Main.user.uid="100",Main.user.profile="",Main.user.point=100,void this.loadConfig();var _this1=this;$.post(Main.api,{ticket:Main.ticket},function(result){var data=eval("("+result+")");if(data.error&&(console.log(data.error_code,data.error),_this1.showLost("错误的用户信息。")),"fail"==data.result)_this1.showLost(data.result);else{if(Main.user.name=data.nickname,0!=data.prizes.length){var dataPrizes=data.prizes[0];sessionStorage.setItem("prizes",JSON.stringify(dataPrizes)),Main.oid=data.prizes[0].ticket,Main.win=data.prizes[0].id,console.log(Main.user.uid)}else if(0!=data.pools.length)Main.user.uid=data.pools[0].ticket,console.log(Main.user.uid);else if(0==data.prizes.length&&0==data.pools.length)return void _this1.showLost("该二维码已参与抽奖！");_this1.loadConfig()}})},Main.prototype.onGetComplete=function(t){var e=t.currentTarget;console.log("get data : ",e.response)},Main.prototype.onGetIOError=function(t){},Main.prototype.onGetProgress=function(t){},Main.prototype.showLost=function(t){console.log("showLost");var e=new egret.Sprite,i=new egret.Shape;i.graphics.beginFill(0,.8),i.graphics.drawRect(0,0,640,1040);var n=new egret.TextField;n.background=!1,n.width=600,n.textColor=16777215,n.textAlign="center",n.size=36,n.text=t,n.y=500,n.x=20,e.addChild(i),e.addChild(n),this.addChild(e),e.alpha=0;var a=egret.Tween.get(e);a.to({alpha:1},400)},Main.showLost=function(t){Main._main.showLost(t)},Main.track=function(t){},Main.trackEvent=function(t){},Main}(egret.DisplayObjectContainer);Main.shopUrl="",Main.win=0,Main.oid="",Main.isTest=!1,Main.userApi="http://play.leasiondata.cn/lsplaycity/user_info",Main.api="http://coeasion.cn/",Main.ticket="d82cf56540134d6f93fb88d3edf5dc50",Main.product_type="tk",Main.user={},Main._main=null,Main.scale=1,Main.luck={},Main.location={country:null,province:null,city:null},Main.award={uid:null,nickname:null,type:"cash",count:.88},__reflect(Main.prototype,"Main");var Scene=function(t){function e(){var e=t.call(this)||this;return e.inLuck=0,e.speed1=0,e.speed2=0,e.speed3=0,e.sa1=0,e.sa2=0,e.sa3=0,e.stop1=120,e.stop2=120,e.stop3=120,e.pList=[],e.gCount=5,e.stopA=10,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e}return __extends(e,t),e.prototype.onAddToStage=function(t){this.stage.stageWidth,this.stage.stageHeight;this.points=[0,0,0],this.list=[],this.list[0]=[Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("1000coupon_png"),Main.createBitmapByName("88yuanhongbao_png"),Main.createBitmapByName("500coupon_png"),Main.createBitmapByName("8yuanhongbao_png"),Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("500coupon_png"),Main.createBitmapByName("88yuanhongbao_png")],this.list[1]=[Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("8yuanhongbao_png"),Main.createBitmapByName("1000coupon_png"),Main.createBitmapByName("500coupon_png"),Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("88yuanhongbao_png"),Main.createBitmapByName("8yuanhongbao_png"),Main.createBitmapByName("500coupon_png")],this.list[2]=[Main.createBitmapByName("1000coupon_png"),Main.createBitmapByName("88yuanhongbao_png"),Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("8yuanhongbao_png"),Main.createBitmapByName("500coupon_png"),Main.createBitmapByName("1000coupon_png"),Main.createBitmapByName("1.8yuanhongbao_png"),Main.createBitmapByName("8yuanhongbao_png")],this.pList=[[0,4,2,3,1],[4,1,0,3,2],[2,3,1,4,0]];var e;for(this.playBar=new egret.Sprite,this.bar1=new egret.Sprite,this.bar2=new egret.Sprite,this.bar3=new egret.Sprite,e=0;e<this.list[0].length;e++)this.list[0][e].scaleY=Main.scale,this.list[1][e].scaleY=Main.scale,this.list[2][e].scaleY=Main.scale,this.list[0][e].x=60-this.list[0][e].width/2,this.list[0][e].y=120*e+60-this.list[0][e].height/2,this.list[1][e].x=60-this.list[1][e].width/2,this.list[1][e].y=120*e+60-this.list[1][e].height/2,this.list[2][e].x=60-this.list[2][e].width/2,this.list[2][e].y=120*e+60-this.list[2][e].height/2,this.bar1.addChild(this.list[0][e]),this.bar2.addChild(this.list[1][e]),this.bar3.addChild(this.list[2][e]);var i=new egret.Shape;i.graphics.beginFill(0,1),i.graphics.drawRect(0,0,440,138);var n=Main.createBitmapByName("sc_png");this.start_png=Main.createBitmapByName("start_png");var a=Main.createBitmapByName("music_png"),s=Main.createBitmapByName("music-close_png"),o=Main.createBitmapByName("top1_png"),r=Main.createBitmapByName("top2_png");this.start_png.x=220,this.start_png.y=668,this.but=this.start_png,a.x=460,a.y=720,s.x=460,s.y=720,o.x=64,o.y=-170,r.x=156,r.y=-40,egret.Tween.get(r).to({y:158},300).call(function(){egret.Tween.get(r).to({y:146},350).call(function(){egret.Tween.get(r).to({y:158},300).call(function(){egret.Tween.get(r).to({y:152},200).call(function(){egret.Tween.get(r).to({y:158},100)})})})});var h=egret.Tween.get(o);h.wait(1200).to({y:14},300).call(function(){egret.Tween.get(o).wait(100).to({scaleX:1.3,scaleY:1.3,x:-20},200).call(function(){egret.Tween.get(o).to({scaleX:1,scaleY:1,x:64},320).call(function(){egret.Tween.get(o).to({scaleX:1.3,scaleY:1.3,x:-20},200).call(function(){egret.Tween.get(o).to({scaleX:1,scaleY:1,x:64},200)})})})}),this.playBar.x=112,this.playBar.y=370,i.x=100,i.y=360,this.bar2.x=146,this.bar3.x=294,this.playBar.addChild(this.bar1),this.playBar.addChild(this.bar2),this.playBar.addChild(this.bar3),this.addChild(n),this.addChild(this.playBar),this.addChild(i),this.addChild(this.start_png),this.addChild(a),this.addChild(o),this.addChild(r),this.playBar.mask=i;var p=this,c=sessionStorage.getItem("prizes");if(c)return p.start_png.touchEnabled=!1,p.toWin(),void sessionStorage.removeItem("prizes");Main.setBut(this.start_png),this.start_png.touchEnabled=!0,this.start_png.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){this.play(),console.log("start_png")},this),Main.setBut(a);var l=RES.getRes("music_mp3"),d=this.soundChannel;setTimeout(function(){Main.setBut(a),d=l.play()},1e3),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){d&&(console.log(d),d.stop(),this.soundChannel=null),this.removeChild(a),this.addChild(s)},this),Main.setBut(s)},e.prototype.setMove=function(t,e,i,n,a){var s=120*this.gCount;return 0>=a?this.points[e]=this.points[e]+(a-this.points[e])/this.stopA:(n+=(i-n)/120,this.points[e]+=n),t.y=this.points[e]%s,n},e.prototype.play=function(){if(0==this.inLuck){this.but.touchEnabled=!1;this.speed1=-80-80*Math.random(),this.speed2=-80-80*Math.random(),this.speed3=-80-80*Math.random(),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this),this.inLuck=1,this.loadLuck()}console.log("play")},e.prototype.initBar=function(){this.removeEventListener(egret.Event.ENTER_FRAME,this.loop,this),this.speed1=0,this.speed2=0,this.speed3=0,this.sa1=0,this.sa2=0,this.sa3=0,this.stop1=120,this.stop2=120,this.stop3=120,this.inLuck=0,console.log("initBar")},e.prototype.toWin=function(){var t,e,i,n=Main.win;t=e=i=n,console.log(t,e,i),this.setStop1(t);var a=this;setTimeout(function(){a.setStop2(e)},1e3),setTimeout(function(){a.setStop3(i)},2e3),setTimeout(function(){a.showEnd()},5e3)},e.prototype.showEnd=function(){var t=this;this.but.touchEnabled=!1,this.end=new End,this.addChild(this.end),setTimeout(function(){t.initBar()},500)},e.prototype.setStop1=function(t){var e=this.pList[0][t],i=120*this.gCount;this.stop1=Math.round((this.sa1*this.stopA+this.points[0])/600)*i-120*e,console.log(this.stop1)},e.prototype.setStop2=function(t){var e=this.pList[1][t],i=120*this.gCount;this.stop2=Math.round((this.sa2*this.stopA+this.points[1])/600)*i-120*e,console.log(this.stop2)},e.prototype.setStop3=function(t){var e=this.pList[2][t],i=120*this.gCount;this.stop3=Math.round((this.sa3*this.stopA+this.points[2])/600)*i-120*e,console.log(this.stop3)},e.prototype.loop=function(){this.sa1=this.setMove(this.bar1,0,this.speed1,this.sa1,this.stop1),this.sa2=this.setMove(this.bar2,1,this.speed2,this.sa2,this.stop2),this.sa3=this.setMove(this.bar3,2,this.speed3,this.sa3,this.stop3)},e.prototype.loadLuck=function(){console.log("loadLuck");var t=this,e=new Date;if(console.log(e),Main.isTest){Main.win=4,alert("test");var i=(new Date).getTime()-e.getTime();return console.log(i),void(2e3>i?setTimeout(function(){t.toWin()},1e3):t.toWin())}2!=this.inLuck&&(this.inLuck=2,$.ajax({url:Main.api,data:{ticket:Main.user.uid},error:function(){Main.showLost("出现错误，请稍后尝试")},success:function(i){if(console.log(i),"success"==i.result){Main.win=i.prizes[0].id,console.log(Main.win),Main.oid=i.prizes[0].ticket;var n=(new Date).getTime()-e.getTime();2e3>n?setTimeout(function(){t.toWin()},1e3):t.toWin()}else i.error_code?Main.showLost(i.error):Main.showLost("出现错误，请稍后尝试")},dataType:"json",async:!0,type:"POST"}))},Object.defineProperty(e,"instance",{get:function(){return e._scene||(e._scene=new e),e._scene},enumerable:!0,configurable:!0}),e}(egret.DisplayObjectContainer);__reflect(Scene.prototype,"Scene");
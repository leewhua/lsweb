var __reflect=this&&this.__reflect||function(e,t,a){e.__class__=t,a?a.push(t):a=[t],e.__types__=e.__types__?a.concat(e.__types__):a},__extends=this&&this.__extends||function(e,t){function a(){this.constructor=e}for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);e.prototype=null===t?Object.create(t):(a.prototype=t.prototype,new a)},End=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){var t=(Math.floor(4*Math.random()),new egret.Shape);t.graphics.beginFill(0,.7),t.graphics.drawRect(0,0,640,1140);var a=new Paper(Main.award.count.toString());a.x=320,a.y=1800;var i;"tk"==Main.product_type?(i=Main.createBitmapByRes(Main.product_type+"_json","logo-white2"),i.x=306,i.y=-26):"bv"==Main.product_type?(i=Main.createBitmapByRes(Main.product_type+"_json","logo-white2"),i.x=306,i.y=-26):(i=Main.createBitmapByRes(Main.product_type+"_json","logo-white"),i.x=306,i.y=-6);var n=Main.createMc("guang_json","guang_png","guang");n.scaleX=3.2,n.scaleY=4.16,n.y=0,n.play(-1);var o,r=new egret.Sprite,s=Main.createBitmapByRes("sc_json","to-qr");s.x=130,s.y=800,t.alpha=0,n.alpha=0,r.alpha=0,s.alpha=0;var d=Main.createBitmapByName("to-city_png");d.x=130,d.y=800,d.alpha=0;var p;p=Main.createBitmapByRes("sc_json","jf-copy"),r.addChild(p),r.x=120,r.y=640,o=d,this.addChild(t),this.addChild(n),this.addChild(a),this.addChild(r),this.addChild(o),Main.setBut(o);var h=egret.Tween.get(t);h.to({alpha:1},600);var l=egret.Tween.get(a);l.wait(400),l.to({y:720},400),l.call(function(){a.play()});var c=egret.Tween.get(n);c.wait(600),c.to({alpha:.6},600);var u=egret.Tween.get(r);u.wait(1200),u.to({alpha:1},400);var y=egret.Tween.get(o);y.wait(1400),y.to({alpha:1},400);$(".wx").click(function(){$(".wx").hide()}),s.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){$(".wx").show(),console.log("$('.wx').show")},this),d.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){window.location.href="http://res.leasiondata.cn/lstatic/kzwyqs/jifen/playcity.html"},this),console.log("$but:"+s.touchEnabled)},t}(egret.Sprite);__reflect(End.prototype,"End");var EventObj=function(e){function t(t,a,i,n,o){var r=e.call(this,t,i,n,o)||this;return r.name=a,r}return __extends(t,e),t}(egret.Event);__reflect(EventObj.prototype,"EventObj");var Help=function(e){function t(){var t=e.call(this)||this;return t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.sp=new egret.Sprite;var t=Main.createBitmapByRes("h321_json","icon");this.scaleY=Main.scale,t.x=t.width/-2,t.y=t.height/-2,this.sp.addChild(t),this.addChild(this.sp),this.sp.rotation=20,this.play()},t.prototype.play=function(){var e=egret.Tween.get(this.sp,{});e.to({rotation:-20},200),e.call(function(){this.play2()},this)},t.prototype.play2=function(){var e=egret.Tween.get(this.sp,{});e.to({rotation:20},200),e.call(function(){this.play()},this)},t}(egret.Sprite);__reflect(Help.prototype,"Help");var LoadingUI=function(e){function t(){var t=e.call(this)||this;return t.weatherObj=["晴","多云","阴","阵雨","小雨","中雨","大雨","冻雨","雨夹雪","沙尘","雾","霾","风","大风","台风","龙卷风","阵雪","小雪","中雪","大雪"],t.points=[{x:40,y:352},{x:244,y:532},{x:60,y:352},{x:290,y:352},{x:180,y:440},{x:40,y:620},{x:200,y:250},{x:90,y:330},{x:60,y:580},{x:70,y:220},{x:60,y:220},{x:110,y:300},{x:65,y:460},{x:40,y:600},{x:90,y:180},{x:40,y:560},{x:196,y:600},{x:200,y:520},{x:80,y:630},{x:40,y:310}],Main.location=window.remote_ip_info,t.loadWeather(),t}return __extends(t,e),t.prototype.getType=function(e){console.log("type:"+Main.location.city+":"+e);for(var t=this.weatherObj.length-1;t>=0;t--)if(e.indexOf(this.weatherObj[t])>-1)return t+1;return 1},t.prototype.createView=function(e){var t;t=1==this.type||5==this.type||11==this.type||16==this.type?Main.createBitmapByRes(Main.product_type+"_json","logo-white"):Main.createBitmapByRes(Main.product_type+"_json","logo-blue"),t.x=500,t.y=20;e.scaleX=e.scaleY=1.12;var a=egret.Tween.get(e);e.alpha=0,a.to({alpha:1},600),this.addChild(e),this.loadMark(),this.loadCopy()},t.prototype.loadCopy=function(){var e=this.type,t="resource/loading/copy/"+e+".png",a=new egret.URLLoader;a.dataFormat=egret.URLLoaderDataFormat.TEXTURE,a.addEventListener(egret.Event.COMPLETE,this.onLoadCopyComplete,this);var i=new egret.URLRequest(t);a.load(i)},t.prototype.loadBg=function(e){var t=this.getType(e);this.type=t;var a="resource/loading/bg/"+t+".jpg",i=new egret.URLLoader;i.dataFormat=egret.URLLoaderDataFormat.TEXTURE,i.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this);var n=new egret.URLRequest(a);i.load(n)},t.prototype.onLoadCopyComplete=function(e){var t=e.target,a=t.data,i=new egret.Bitmap(a),n=egret.Tween.get(i),o=this.points[this.type-1].x,r=this.points[this.type-1].y;i.alpha=0,i.y=r+10,i.x=o,n.to({y:r,alpha:1},400),this.addChild(i)},t.prototype.onLoadComplete=function(e){var t=e.target,a=t.data;this.createView(new egret.Bitmap(a))},t.prototype.loadMark=function(){var e="resource/loading/mark.png",t=new egret.URLLoader;t.dataFormat=egret.URLLoaderDataFormat.TEXTURE,t.addEventListener(egret.Event.COMPLETE,this.onLoadMarkComplete,this);var a=new egret.URLRequest(e);t.load(a)},t.prototype.onLoadMarkComplete=function(e){var t=e.target,a=t.data,i=new egret.Sprite,n=new egret.Bitmap(a),o=new egret.TextField;o.background=!1,o.textColor=16777215,o.size=30,o.text=Main.location.city,o.x=46,o.y=6,i.addChild(o),i.addChild(n),this.addChild(i);var r=egret.Tween.get(i);i.alpha=0,i.y=960,i.x=30,r.to({x:20,alpha:1},400)},t.prototype.loadCity=function(){console.log("loadCity");var e=this;$.ajax({url:"http://int.dpool.sina.com.cn/iplookup/iplookup.php?format=js",data:{},success:function(t){console.log("loadCity:"+t),1==t.ret&&(Main.location=t,e.loadWeather())},dataType:"text",async:!1,type:"GET"})},t.prototype.loadWeather=function(){console.log("loadWeather");var e=this;$.ajax({url:"http://wthrcdn.etouch.cn/weather_mini",data:{city:Main.location.city},success:function(t){(t.status=1e3)?(console.log("loadWeather:"+t.data),e.loadBg(t.data.forecast[0].type)):setTimeout(function(){e.loadWeather()},1e3)},dataType:"json",async:!1,type:"GET"})},t}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var Main=function(_super){function Main(){var e=_super.call(this)||this;return e.count=0,e.loaded=0,Main._main=e,e.addEventListener(egret.Event.ADDED_TO_STAGE,e.onAddToStage,e),e.addEventListener("event",e.eventHandler,e),e.addEventListener(egret.Event.ENTER_FRAME,e.loop,e),e}return __extends(Main,_super),Main.prototype.loop=function(){if(this.count++,this.count>80&&this.loaded){this.removeEventListener(egret.Event.ENTER_FRAME,this.loop,this),this.showScene();var e=this,t=egret.Tween.get(this.loadingView);t.to({y:-1040},600,egret.Ease.circIn),t.call(function(){e.loadingView&&(e.removeChild(e.loadingView),e.loadingView=null)})}},Main.prototype.eventHandler=function(e){switch(e.name){case"next":break;case"to_shop":break;case"clear_old":}},Main.prototype.onAddToStage=function(e){var t=window.innerWidth/640,a=window.innerHeight/1040;Main.scale=t/a,this.stage.scaleMode=egret.StageScaleMode.EXACT_FIT,this.getData()?this.loadUser():Main.showLost(0)},Main.prototype.loadConfig=function(){console.log("loadConfig"),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/config.json","resource/")},Main.prototype.showScene=function(){console.log("showScene"),this.scene=new Scene,this.stage.addChildAt(this.scene,0)},Main.prototype.clearOld=function(){this.old&&this.old.parent&&this.removeChild(this.old),this.old=null},Main.prototype.onConfigComplete=function(e){console.log("onConfigComplete"),RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),"yd"==Main.product_type?RES.loadGroup("yd"):"tk"==Main.product_type?RES.loadGroup("tk"):"bv"==Main.product_type&&RES.loadGroup("bv")},Main.prototype.onResourceLoadComplete=function(e){console.log("onResourceLoadComplete:"+e.groupName),"d1"==e.groupName?RES.loadGroup("c"):"d2"==e.groupName?RES.loadGroup("c"):"c"==e.groupName?(this.loaded=1,Main.trackEvent("loading_ok")):("yd"==e.groupName||"tk"==e.groupName||"bv"==e.groupName)&&(this.loadingView=new LoadingUI,this.addChild(this.loadingView),RES.loadGroup("d1"))},Main.createBitmapByRes=function(e,t){var a=new egret.Bitmap,i=RES.getRes(e);return console.log("name::"+t+"::"+e),a.texture=i.getTexture(t),a},Main.createBitmapByName=function(e){var t=new egret.Bitmap,a=RES.getRes(e);return t.texture=a,t},Main.tweenTo=function(e,t,a,i,n,o,r){var s=egret.Tween.get(e),d=e.x,p=e.y,h=e.width,l=e.height;e.scaleX=e.scaleY=o,e.x=d+i+(1-o)/2*h,e.y=p+n+(1-o)/2*l,s.wait(t),s.to({alpha:1,scaleX:1,scaleY:1,x:d,y:p},a,r)},Main.createMc=function(e,t,a){var i=RES.getRes(e),n=RES.getRes(t),o=new egret.MovieClipDataFactory(i,n),r=new egret.MovieClip(o.generateMovieClipData(a));return r},Main.setBut=function(e){e&&(e.touchEnabled=!0,e.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){e.alpha=.68},e),e.addEventListener(egret.TouchEvent.TOUCH_END,function(){e.alpha=1},e),e.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){e.alpha=1},e))},Main.prototype.onResourceLoadError=function(e){console.warn("Group:"+e.groupName+" has failed to load"),this.onResourceLoadComplete(e)},Main.prototype.onResourceProgress=function(e){},Main.prototype.getData=function(){var url=window.location.href.split("#")[0].split("?")[1],ut;return console.log("loadUser"),Main.product_type=eval("$.product_type"),"tk"==Main.product_type?Main.api="http://leasiondata.cn/luck/play1":"yd"==Main.product_type?Main.api="http://leasiondata.cn/luck/play2":"bv"==Main.product_type&&(Main.api="http://leasiondata.cn/luck/play2"),Main.isTest?!0:url&&url.length>20?(ut=url.split(","),Main.user_ticket=ut[0],Main.status_ticket=ut[1],console.log(Main.user_ticket,Main.status_ticket),!0):!1},Main.prototype.loadUser=function(){if(console.log("loadUser"),Main.isTest)return void this.loadConfig();var e=this;$.ajax({url:Main.api,data:{ticket:Main.user_ticket,desc:"test"},success:function(t){1==t.msg?(Main.user=t.data,e.loadConfig()):"invalid ticket3"==t.data?Main.showLost(1):setTimeout(function(){e.loadUser()},1e3)},dataType:"json",async:!0,type:"POST"})},Main.prototype.onGetComplete=function(e){var t=e.currentTarget;console.log("get data : ",t.response)},Main.prototype.onGetIOError=function(e){},Main.prototype.onGetProgress=function(e){},Main.prototype.showLost=function(e){console.log("showLost");var t=new egret.Sprite,a=new egret.Shape;a.graphics.beginFill(0,.8),a.graphics.drawRect(0,0,640,1040);var i=new egret.TextField;i.background=!1,i.width=600,i.textColor=16777215,i.textAlign="center",i.size=36,0==e?i.text="错误的链接，请重新扫码...":1==e?i.text="已过期，请重新扫码...":2==e?i.text="网络异常，请重新扫码...":i.text="已过期，请重新扫码...",i.y=500,i.x=20,t.addChild(a),t.addChild(i),this.addChild(t),t.alpha=0;var n=egret.Tween.get(t);n.to({alpha:1},400)},Main.showLost=function(e){Main._main.showLost(e)},Main.track=function(e){},Main.trackEvent=function(e){},Main}(egret.DisplayObjectContainer);Main.shopUrl="",Main.api="http://lsid.me/luck/play",Main.user_ticket="d82cf56540134d6f93fb88d3edf5dc50",Main.status_ticket="136c4f5463e047deb8e797c5a94280dc",Main.product_type="tk",Main.user=null,Main._main=null,Main.scale=1,Main.isTest=!0,Main.location={country:null,province:null,city:null},Main.award={uid:null,nickname:null,type:"cash",count:.88},__reflect(Main.prototype,"Main");var Paper=function(e){function t(t){var a=e.call(this)||this;return a.index=t,a.addEventListener(egret.Event.ADDED_TO_STAGE,a.onAddToStage,a),a}return __extends(t,e),t.prototype.onAddToStage=function(e){this.paper=new egret.Sprite;for(var t,a=Main.createBitmapByRes("hb_json","p-down"),i=Main.createBitmapByRes("hb_json","p-m"),n=Main.createBitmapByRes("hb_json","p-up"),n=Main.createBitmapByRes("hb_json","p-up"),o=new egret.Sprite,r=this.index.split(""),s=-26,d=0;d<r.length;d++){var p=r[d];"."==p&&(p="10"),t=Main.createBitmapByRes("font_json","b"+p),t.x=s,s+="10"==p?42:"1"==p?80:90,o.addChild(t)}var h;"jifen"==Main.award.type?(h=Main.createBitmapByRes("sc_json","jf"),h.x=s,h.y=20):(h=Main.createBitmapByRes("sc_json","yuan"),h.x=s,h.y=20),o.addChild(h),this.paper.y=260,this.paper.x=50,n.y=176,o.x=60+(380-o.width)/2,o.y=60,this.paper.addChild(i),this.paper.addChild(o),this.addChild(a),this.addChild(this.paper),this.addChild(n),a.x-=260,a.y-=420,this.paper.x-=260,this.paper.y-=420,n.x-=260,n.y-=420},t.prototype.play=function(){var e=egret.Tween.get(this.paper);e.to({y:-370},300)},t}(egret.Sprite);__reflect(Paper.prototype,"Paper");var Scene=function(e){function t(){var t=e.call(this)||this;return t.count=0,t.inLuck=!1,t.inHelp=!1,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t.addEventListener("event",t.eventHandler,t),t}return __extends(t,e),t.prototype.eventHandler=function(e){switch(e.name){case"play_end":console.log("play_end"),this.end=new End,this.addChild(this.end),this.addChild(this.logo);break;case"to_shop":}console.log(e.type+":"+e.name)},t.prototype.onAddToStage=function(e){var t=(this.stage.stageWidth,this.stage.stageHeight,Main.createBitmapByName("bg_jpg"));t.x=0,t.y=0,t.scaleX=t.scaleY=2,this.tree=new Tree,this.tree.x=320,this.tree.y=1200,this.tree.scaleX=this.tree.scaleY=.96,this.logo=Main.createBitmapByRes(Main.product_type+"_json","logo-white"),this.logo.x=20,this.logo.y=20,this.helpBut=Main.createBitmapByName("help-but_png"),this.helpBut.x=640-this.helpBut.width-0,this.helpBut.y=0,this.helpBut.scaleY=Main.scale;var a=Main.createBitmapByRes("sc_json","bottom");a.y=1040;var i=Main.createBitmapByRes("sc_json","clound");i.x=600,i.y=160;var n=Main.createBitmapByRes("sc_json","clound");n.x=100,n.y=800,n.scaleX=n.scaleY=.6;var o=Main.createBitmapByRes("sc_json","g");o.x=600,o.y=200,this.title=Main.createBitmapByName("title_png"),this.title.x=100,this.title.y=120,this.pro=Main.createBitmapByRes(Main.product_type+"_json","pro"),this.pro.x=50,this.pro.y=206,this.pro.scaleX=this.pro.scaleY=2,this.help=new Help,this.help.x=320,this.help.y=460,this.addChild(t),this.addChild(i),this.addChild(n),this.addChild(o),this.addChild(this.tree),this.addChild(a),this.addChild(this.title),this.addChild(this.helpBut),a.y=953,console.log(a.height);var r=this;setTimeout(function(){r.play321()},800);var s=egret.Tween.get(i);s.to({x:-400},3e4);var d=egret.Tween.get(n);d.to({x:640},18e3);var r=this;window.playTree=function(){r.help.parent&&r.help.parent.removeChild(r.help),0==r.tree.index&&(r.tree.playIndex(1),r.loadLuck())},this.helpBut.touchEnabled=!0,this.helpBut.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){r.inHelp=!0;var t=Main.createBitmapByName("help_png");r.addChild(t),t.scaleX=t.scaleY=2,t.alpha=0;var a=egret.Tween.get(t);a.to({alpha:1},400),t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_TAP,function(e){r.inHelp=!1,r.removeChild(t)},this)},this)},t.prototype.play321=function(){var e=this,t=Main.createBitmapByRes("h321_json","h3"),a=Main.createBitmapByRes("h321_json","h2"),i=Main.createBitmapByRes("h321_json","h1"),n=new egret.Sprite,o=new egret.Sprite,r=new egret.Sprite;t.x=t.width/-2,t.y=t.height/-2,a.x=a.width/-2,a.y=a.height/-2,i.x=i.width/-2,i.y=i.height/-2,n.addChild(t),o.addChild(a),r.addChild(i),n.x=320,n.y=580,o.x=320,o.y=580,r.x=320,r.y=580,e.addChild(n);var s=egret.Tween.get(n);s.to({scaleX:3,scaleY:3,alpha:0},500),s.call(function(){var t=egret.Tween.get(o);t.wait(500),e.addChild(o),t.to({scaleX:3,scaleY:3,alpha:0},500),t.call(function(){var t=egret.Tween.get(r);t.wait(500),e.addChild(r),t.to({scaleX:3,scaleY:3,alpha:0},500),t.call(function(){e.play()})})})},t.prototype.play=function(){var e=egret.Tween.get(this.title);e.to({y:100,alpha:0},400);var t=egret.Tween.get(this.pro);t.to({alpha:0},400);var a=this;t.call(function(){a.pro.y=680;var e=egret.Tween.get(a.pro);e.wait(200),e.to({alpha:1},400)});var i=egret.Tween.get(this.tree);i.wait(100),i.to({y:1100,scaleX:1,scaleY:1},500),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this)},t.prototype.playYao=function(){this.help.parent&&this.help.parent.removeChild(this.help),0==this.tree.index&&(this.tree.playIndex(1),this.loadLuck())},t.prototype.playEnd=function(){console.log("playEnd:"+this),this.help&&this.help.parent&&this.help.parent.removeChild(this.help),this.count=1200,0==this.tree.index?(this.tree.playIndex(1),this.loadLuck()):this.loadLuck(),this.removeEventListener(egret.Event.ENTER_FRAME,this.loop,this)},t.prototype.loop=function(){return this.inHelp?void(this.count=0):(this.count++,void(this.count>=100?this.playEnd():20==this.count&&0==this.tree.index&&this.addChild(this.help)))},t.prototype.loadLuck=function(){console.log("loadLuck");var e=this;if(!this.inLuck){if(this.inLuck=!0,Main.isTest){var t=Math.random();return t>.5?Main.award={type:"jifen"}:Main.award={type:"cash"},Main.award.count=1,void(0==e.tree.index?(e.tree.index=4,e.tree.playIndex(2)):e.tree.index=4)}$.ajax({url:Main.api,data:{ticket:Main.status_ticket,desc:"抽中红包"},success:function(t){if(1==t.msg){if(Main.award=t.data,"cash"==t.data.type){var a=parseInt(t.data.count)/100;Main.award.count=a}else Main.award.count=10;0==e.tree.index?(e.tree.index=4,e.tree.playIndex(2)):e.tree.index=4}else"invalid ticket3"==t.data?Main.showLost(1):Main.showLost(2)},dataType:"json",async:!0,type:"POST"})}},t}(egret.DisplayObjectContainer);__reflect(Scene.prototype,"Scene");var Tree=function(e){function t(){var t=e.call(this)||this;return t.index=0,t.count=0,t.addEventListener(egret.Event.ADDED_TO_STAGE,t.onAddToStage,t),t}return __extends(t,e),t.prototype.onAddToStage=function(e){this.tree=Main.createMc("tree1_json","tree1_png","tree"),this.d1=Main.createMc("d1_json","d1_png","dmov1"),this.tree.scaleX=this.tree.scaleY=2,this.d1.scaleX=this.d1.scaleY=2,this.tree.x=-350,this.tree.y=-900,this.d1.x=-350,this.d1.y=-900,this.playIndex(0),this.addEventListener(egret.Event.ENTER_FRAME,this.loop,this)},t.prototype.playIndex=function(e){for(;this.numChildren>0;)this.removeChildAt(0);0==e?(this.addChild(this.tree),this.tree.gotoAndStop(0),this.now=this.tree):1==e?(this.addChild(this.tree),this.tree.play(),this.now=this.tree):2==e?(this.addChild(this.d1),this.d1.play(),this.now=this.d1):3==e?(this.addChild(this.d1),this.now=this.tree):4==e&&this.addChild(this.now),this.index=e,this.count++},t.prototype.loop=function(){if(this.now.currentFrame>=this.now.totalFrames){var e=this.index;0==e||(1==e?this.playIndex(0):2==e?(this.playIndex(3),this.parent.dispatchEvent(new EventObj("event","play_end"))):3==e||4==e&&this.playIndex(2))}},t}(egret.Sprite);__reflect(Tree.prototype,"Tree");
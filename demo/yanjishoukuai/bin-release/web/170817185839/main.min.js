var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)},PopUp=function(t){function e(){var e=t.call(this)||this;return e.x=0,e.y=0,e.view=new egret.Sprite,e.touchEnabled=!0,e}return __extends(e,t),e.prototype.show=function(t,e,i){void 0===t&&(t=!1),void 0===e&&(e=!0),void 0===i&&(i=!0);var n=0;t&&(n=500);var a=new egret.Shape;if(a.graphics.beginFill(0,.8),a.graphics.drawRect(0,0,StageUtils.stage.stageWidth,StageUtils.stage.stageHeight),a.graphics.endFill(),e&&this.addChild(a),this.addChild(this.view),a.alpha=this.view.alpha=0,Global.fadeIn(a),this.view.scaleX=this.view.scaleY=.6,i){var o=egret.Tween.get(this.view);o.wait(n),o.to({alpha:1,scaleX:1,scaleY:1},500,egret.Ease.backOut)}},e.prototype.out=function(){Global.fadeOut(this);var t=egret.Tween.get(this.view);t.to({scaleX:1.2,scaleY:1.2},400,egret.Ease.cubicIn),t.call(function(){this.parent&&this.parent.removeChild(this)})},e.prototype.setData=function(t){this.data=t},e}(egret.Sprite);__reflect(PopUp.prototype,"PopUp");var SubmitView=function(t){function e(){var e=t.call(this)||this;return e.show(!1),e}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.view.y=-50;var i=Global.createBitmapByName("pop_bg_png");StageUtils.centerInParent(i),this.view.addChild(i);var n=new CustomImage("resource/assets/reward/"+GameView.rewardData.desc+"_input.png",!0,function(){n.x=StageUtils.SW-n.width>>1,n.y=(StageUtils.SH-n.height>>1)-100});this.view.addChild(n);var a=new CustomImage("resource/assets/reward/sw_input_bg.png",!0,function(){a.x=StageUtils.SW-a.width>>1,a.y=(StageUtils.SH-a.height>>1)+200});this.view.addChild(a);var o=this.getTxt();o.text="",o.maxChars=20,o.width=300,o.x=200,o.y=644,this.view.addChild(o);var r=this.getTxt();r.text="",r.maxChars=11,r.restrict="0-9",r.width=300,r.x=200,r.y=712,this.view.addChild(r);var s=this.getTxt();s.text="",s.multiline=!0,s.maxChars=100,s.width=300,s.height=100,s.x=200,s.y=776,this.view.addChild(s);var h=Global.createBitmapByName("btn_get_png");h.x=StageUtils.SW-h.width>>1,h.y=StageUtils.SH-100,this.view.addChild(h),h.touchEnabled=!0,h.addEventListener(egret.TouchEvent.TOUCH_TAP,this.touchHandler,this),Global.setBut(h),this.txtName=o,this.txtPhone=r,this.txtAddress=s},e.prototype.touchHandler=function(){this.saveLuck()},e.prototype.saveLuck=function(){var t=this.txtName.text,e=this.txtPhone.text,i=this.txtAddress.text;if(t&&e&&i){var n=GameView.rewardData.require;console.log(n),$.ajax({url:Main.PLAY_API,data:{ticket:GameView.rewardData.ticket,ADDR:t+","+e+","+i},success:function(t){"success"==t.result?(Main.removePop("SubmitView"),Main.showPop("TipsView"),sessionStorage.removeItem("yanjishoukuai")):"invalidticketparam"==t.reason?Main.showLost(21):"invalidticket"==t.reason?Main.showLost(3):Main.showLost(1)},error:function(){Main.showLost(2)},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Main.showLost(2)}})}else Message.show("请填写完整信息~")},e.prototype.getTxt=function(){var t=new egret.TextField;return t.type=egret.TextFieldType.INPUT,t.textColor=0,t.size=25,t},e}(PopUp);__reflect(SubmitView.prototype,"SubmitView");var LastTimeView=function(t){function e(){return t.call(this)||this}return __extends(e,t),e.prototype.go=function(){GameDispatcher.instance.dispatchEvent(new EventObj("custom","timer_go"))},e.prototype.play=function(){var t=this,e=new Middle(Global.createBitmapByName("time1_png")),i=new Middle(Global.createBitmapByName("time2_png")),n=new Middle(Global.createBitmapByName("time3_png")),a=new Middle(Global.createBitmapByName("timego_png"));this.addChild(n),SoundManager.getInstance().play("1_mp3",.2);var o=egret.Tween.get(n);o.wait(500),o.to({scaleX:2,scaleY:2,alpha:0},500),o.call(function(){t.removeChild(n);var o=egret.Tween.get(i);o.wait(500),t.addChild(i),SoundManager.getInstance().play("1_mp3",.2),o.to({scaleX:2,scaleY:2,alpha:0},500),o.call(function(){t.removeChild(i);var n=egret.Tween.get(e);n.wait(500),t.addChild(e),SoundManager.getInstance().play("1_mp3",.2),n.to({scaleX:2,scaleY:2,alpha:0},500),n.call(function(){t.removeChild(e);var i=egret.Tween.get(a);i.wait(500),t.addChild(a),SoundManager.getInstance().play("go_mp3",.5),i.to({scaleX:2,scaleY:2,alpha:0},500),i.call(function(){t.removeChild(a),t.go()})})})})},e}(egret.DisplayObjectContainer);__reflect(LastTimeView.prototype,"LastTimeView");var ManView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container);var t=Global.createBitmapByName("car_png");t.x=-285,t.y=-40,this.addChild(t),this.mc=Global.createMc("man_json","man_png","man"),this.mc.x=-this.mc.width>>1,this.mc.y=-this.mc.height>>1,this.addChild(this.mc)},e.prototype.addProp=function(t){t.x=-150+50*Math.random()-25,t.y=90,this.container.addChild(t)},e.prototype.stand=function(){this.mc.gotoAndPlay("stand",-1),this.mc.frameRate=12},e.prototype.play=function(){this.mc.gotoAndPlay("play",-1),this.mc.frameRate=24,SoundManager.getInstance().play("play_mp3")},e.getInstance=function(){return e._instance||(e._instance=new e),e._instance},e}(egret.DisplayObjectContainer);__reflect(ManView.prototype,"ManView");var PropItemView=function(t){function e(e){var i=t.call(this)||this;i.index=8,i.id=e,i.canSelect=!0,i.canMove=!0;var n=Global.createBitmapByName("prop"+e+"_png");return i.icon=new Middle(n),i.addChild(i.icon),i.addEventListener(egret.TouchEvent.TOUCH_TAP,i.clickHandler,i),i}return __extends(e,t),e.prototype.clickHandler=function(){this.isGlow&&(SoundManager.getInstance().play("click_mp3",.5,1),GameDispatcher.instance.dispatchEvent(new EventObj("custom","item_click",!1,!1,{id:this.id,x:this.x,y:this.y})))},e.prototype.setGlow=function(t){this.isGlow!=t&&(t?(this.touchEnabled=!0,this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)):(this.touchEnabled=!1,this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.icon.filters=[]),this.isGlow=t)},e.prototype.enterFrameHandler=function(){this.icon.filters=[new egret.GlowFilter(64767,.8,this.index,this.index,2,3,!1,!1)],this.isAdd?(this.index+=2,this.index>15&&(this.isAdd=!1)):(this.index-=2,this.index<0&&(this.isAdd=!0))},e}(egret.DisplayObjectContainer);__reflect(PropItemView.prototype,"PropItemView");var PropListView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.initList()},e.prototype.initList=function(){this.container=new egret.DisplayObjectContainer,this.addChild(this.container),this.listArr=[];for(var t=0;6>t;t++)for(var e=0;3>e;e++){var i=new PropItemView(Math.ceil(8*Math.random()));this.container.addChild(i),i.x=110*t+45,i.y=160*e+330,this.listArr.push(i)}},e.prototype.move=function(t){t?(this.randomGlow(),this.addEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this)):(this.removeEventListener(egret.Event.ENTER_FRAME,this.enterFrameHandler,this),this.removeSelect())},e.prototype.enterFrameHandler=function(){for(var t,e=0,i=[],n=this.listArr.length,a=0;n>a;a++){var o=this.listArr[a];o&&(o.canMove&&(o.x-=2),o.x<50&&o.canSelect&&(i.push(o.y),e++,o.canSelect=!1,o.isGlow&&(o.setGlow(!1),t=!0)),o.x<-50&&(this.container.removeChild(o),this.listArr.splice(a,1),a--,n--))}e>0&&this.addProp(e,i,t)},e.prototype.removeSelect=function(){if(this.select){var t=this.listArr.indexOf(this.select);-1!=t&&this.listArr.splice(t,1),this.container.removeChild(this.select),this.select=null}},e.prototype.randomGlow=function(){for(var t=this.listArr.length,e=[],i=0;t>i;i++){var n=this.listArr[i];n&&n.canSelect&&e.push(n)}var a=Math.floor(Math.random()*e.length),n=e[a];console.log("index:"+a),n&&(n.setGlow(!0),this.select=n)},e.prototype.addProp=function(t,e,i){for(var n=0;t>n;n++){var a=new PropItemView(Math.ceil(8*Math.random()));this.container.addChild(a),a.x=705,a.y=e[n],this.listArr.push(a)}i&&this.randomGlow()},e}(egret.DisplayObjectContainer);__reflect(PropListView.prototype,"PropListView");var GameView=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.init(),e.addEvent(),e}return __extends(e,t),e.prototype.init=function(){var t=Global.createBitmapByName("game_bg_png");t.width=StageUtils.stage.stageWidth,t.height=StageUtils.stage.stageHeight,this.addChild(t);var e=Global.createBitmapByName("game_box_png");StageUtils.centerInParent(e,0,-130),this.addChild(e);var i=Global.createBitmapByName(Main.product_type+"_json.logo-blue");StageUtils.centerInParent(i,0,-500),this.addChild(i),this.propList=new PropListView,this.addChild(this.propList),this.lastTime=new LastTimeView,StageUtils.centerInParent(this.lastTime,-130,450),this.addChild(this.lastTime),this.lastTime.play();var n=Global.createBitmapByName("game_tip_png");StageUtils.centerInParent(n,-40,230),this.addChild(n);var a=this;setTimeout(function(){a.removeChild(n)},4e3),this.timer=new egret.Timer(1e3),this.timer.addEventListener(egret.TimerEvent.TIMER,this.timerHandler,this),this.timerIndex=0,this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_TAP,this.clickHandler,this),this.container=new egret.DisplayObjectContainer,this.addChild(this.container);var o=ManView.getInstance();o.x=550,o.y=900,o.stand(),this.addChild(o)},e.prototype.addMoveProp=function(t){var e=t.id,i=t.x,n=t.y,a=ManView.getInstance();a.play();var o=Global.createBitmapByName("prop"+e+"_png");o.anchorOffsetX=o.width>>1,o.anchorOffsetY=o.height>>1,o.x=i,o.y=n,this.container.addChild(o);egret.Tween.get(o).to({y:900,rotation:90*Math.random()-45},500).call(function(){a.stand(),a.addProp(o)}),egret.Tween.get(a).to({x:i+150},400)},e.prototype.clickHandler=function(){this.tip&&this.tip.parent&&this.removeChild(this.tip)},e.prototype.timerHandler=function(){this.timerIndex++,this.timerIndex>3&&(this.tip||(this.tip=new GameTipView),this.addChild(this.tip),this.timerIndex=0)},e.prototype.addEvent=function(){GameDispatcher.instance.addEventListener("custom",this.customEventHandler,this)},e.prototype.customEventHandler=function(t){if("timer_go"==t.name)this.propList.move(!0),this.timer.start(),this.tip||(this.tip=new GameTipView),this.addChild(this.tip),this.timerIndex=0;else if("item_click"==t.name){this.timerIndex=0,this.addMoveProp(t.data);var e=Math.ceil(4*Math.random());1==e?(this.propList.move(!1),this.saveLuck()):this.index>=3?(this.propList.move(!1),this.saveLuck()):(this.propList.removeSelect(),this.propList.randomGlow()),this.index++}},e.prototype.saveLuck=function(){var t=this;return Main.isTest?void t.showEnd():void $.ajax({url:Main.PLAY_API,data:{ticket:Main.user_ticket,desc:"抽中红包"},success:function(i){"success"==i.result?0!=i.prizes.length?(e.rewardData=i.prizes[0],Main.user_ticket=i.prizes[0].ticket,t.showEnd()):Main.showLost(1):"invalidticketparam"==i.reason?Main.showLost(21):"invalidticket"==i.reason?Main.showLost(3):Main.showLost(1)},error:function(){Main.showLost(2)},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Main.showLost(2)}})},e.prototype.showEnd=function(){Main.showPop("EndView"),this.timer.stop()},e}(egret.DisplayObjectContainer);__reflect(GameView.prototype,"GameView");var HelpPop=function(t){function e(){var e=t.call(this)||this;return e.show(!1),e}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.view.y=-50;var i=Global.createBitmapByName("pop_bg_png");StageUtils.centerInParent(i),this.view.addChild(i);var n=Global.createBitmapByName("help_bg_png");StageUtils.centerInParent(n,0,50),this.view.addChild(n);var a=Global.createBitmapByName("ok_png");StageUtils.centerInParent(a,0,480),this.view.addChild(a),Global.setBut(a),a.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){Main.removePop("HelpPop")},this)},e}(PopUp);__reflect(HelpPop.prototype,"HelpPop");var LoadingUI=function(t){function e(){var e=t.call(this)||this;return e.getType(),e}return __extends(e,t),e.prototype.setLoadComp=function(){this.isLoadComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.setTimeComp=function(){this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.checkComp=function(){return this.isLoadComp&&this.isTimeComp},e.prototype.timerEndHandler=function(){this.sendMsg(6),this.setTimeComp()},e.prototype.touchClickHandler=function(){this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.getType=function(){for(var t=RES.getRes(Main.product_type+"_copy_json"),e=[],i=0;i<t.length;i++){var n=t[i].level;e[n]||(e[n]=[]),e[n].push(t[i])}var a=new Date,o=this.pattern(a,"yyyy-MM-dd"),r=this.pattern(a,"HH:mm"),s=a.getDay();Main.isTest&&(o="2016-11-24");var h=new Date(o).getTime();0==s&&(s=7);for(var l={w1:1,w2:2,w3:3,w4:4,w5:5,w6:6,w7:7},i=e.length-1;i>=0;i--)if(e[i])for(var d=0;d<e[i].length;d++){var c,p,g=e[i][d];if(console.log("d:"+a,r,g.date[0],g.date[1],g.time[0],g.time[1],s,l[g.date[0]]),g.date[0])if(l[g.date[0]]){if(console.log("www:"+s,l[g.date[0]]),s<l[g.date[0]]){console.log("o1");continue}}else if(c=new Date(g.date[0]).getTime(),console.log("www:"+a,c),c>h){console.log("o2");continue}if(g.date[1]){if(l[g.date[1]]){if(s>l[g.date[1]]){console.log("o3");continue}}else if(p=new Date(g.date[1]).getTime(),console.log("www2:"+h,p),h>p){console.log("o4");continue}}else if(g.date[0])if(l[g.date[0]]){if(s!=l[g.date[0]]){console.log("o5");continue}}else if(c=new Date(g.date[0]).getTime(),console.log("www3:"+h,c),h!=c){console.log("o6");continue}if(g.time[0]&&r<g.time[0])console.log("o7");else{if(!(g.time[1]&&r>g.time[1])){var u=g.data,m=Math.floor(Math.random()*u.length);return this.type=u[m],this.loadBg(),void console.log("find:"+g,g.data,this.type,m)}console.log("o8")}}},e.prototype.loadBg=function(){var t="resource/assets/loading/bg/"+this.type+".jpg",e=new egret.URLLoader;e.dataFormat=egret.URLLoaderDataFormat.TEXTURE,e.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this);var i=new egret.URLRequest(t);e.load(i),this.timer=new egret.Timer(3e3,1),this.timer.addEventListener(egret.TimerEvent.TIMER_COMPLETE,this.timerEndHandler,this),this.timer.start(),this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.touchEnd,this);var n=Global.createBitmapByName("continue_png");n.x=StageUtils.stage.stageWidth-n.width,n.y=StageUtils.stage.stageHeight-n.height,this.addChild(n),n.touchEnabled=!0,n.once(egret.TouchEvent.TOUCH_TAP,this.containueHandler,this)},e.prototype.containueHandler=function(){this.sendMsg(5),this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.sendMsg=function(t){console.log("sendMsg:"+t),$.ajax({url:"http://123.59.156.230/newpic",data:{loading:t},success:function(t){console.log("sendMsg")},error:function(){},dataType:"json",async:!0,type:"POST"})},e.prototype.touchBegin=function(t){this.beginX=t.stageX,this.beginY=t.stageY,this.beginTime=egret.getTimer(),console.log("touchBegin:"+this.beginY)},e.prototype.touchEnd=function(t){var e,i=t.stageX,n=t.stageY,a=i-this.beginX,o=n-this.beginY,r=egret.getTimer();Math.abs(a)>Math.abs(o)?(e=a/(r-this.beginTime),e>0?this.dir=4:this.dir=3):(e=o/(r-this.beginTime),e>0?this.dir=2:this.dir=1),console.log("touchEnd:"+e,a,o,i,this.beginX),Math.abs(e)<.3||(this.sendMsg(this.dir),this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin())},e.prototype.onLoadComplete=function(t){var e=t.target,i=e.data;this.createView(new egret.Bitmap(i))},e.prototype.createView=function(t){var e=Global.createBitmapByName(Main.product_type+"_json.logo-white");e.x=500,e.y=20,t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,t.alpha=0;egret.Tween.get(t).to({alpha:1},600);this.addChildAt(t,0),this.addChild(e)},e.prototype.pattern=function(t,e){var i={"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours()%12==0?12:t.getHours()%12,"H+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()},n={0:"/u65e5",1:"/u4e00",2:"/u4e8c",3:"/u4e09",4:"/u56db",5:"/u4e94",6:"/u516d"};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),/(E+)/.test(e)&&(e=e.replace(RegExp.$1,(RegExp.$1.length>1?RegExp.$1.length>2?"/u661f/u671f":"/u5468":"")+n[t.getDay()+""]));for(var a in i)new RegExp("("+a+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?i[a]:("00"+i[a]).substr((""+i[a]).length)));return e},e}(egret.Sprite);__reflect(LoadingUI.prototype,"LoadingUI");var LoadingUI1=function(t){function e(){var e=t.call(this)||this;return e.index=0,e.loadBg(),e}return __extends(e,t),e.prototype.setLoadComp=function(){Main.instance.showLogin()},e.prototype.setTimeComp=function(){this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.checkComp=function(){return!0},e.prototype.timerEndHandler=function(){this.sendMsg(6),this.setTimeComp()},e.prototype.touchClickHandler=function(){this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.loadBg=function(){this.touchEnabled=!0,this.addEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),this.addEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,this.touchEnd,this),this.container=new egret.DisplayObjectContainer,this.addChild(this.container);var t=Global.createBitmapByName("car_png");t.x=-285,t.y=-40,this.container.addChild(t),this.mc=Global.createMc("man_json","man_png","man"),this.mc.x=-this.mc.width>>1,this.mc.y=-this.mc.height>>1,this.container.addChild(this.mc),this.mc.gotoAndPlay("play",-1),this.mc.frameRate=24,this.container.scaleX=-.7,this.container.scaleY=.7,this.container.y=StageUtils.CH;var e=Global.createBitmapByName("loading_bar_bg_png");e.x=StageUtils.SW-e.width>>1,e.y=(StageUtils.SH-e.height>>1)+150,this.addChild(e),this.txtPro=new egret.TextField,this.txtPro.textColor=2208255,this.txtPro.text="0%",this.txtPro.textAlign=egret.HorizontalAlign.CENTER,this.txtPro.width=200,this.txtPro.x=StageUtils.SW-this.txtPro.width>>1,this.txtPro.y=e.y+50,this.addChild(this.txtPro)},e.prototype.containueHandler=function(){this.sendMsg(5),this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin()},e.prototype.sendMsg=function(t){console.log("sendMsg:"+t),$.ajax({url:"http://123.59.156.230/newpic",data:{loading:t},success:function(t){console.log("sendMsg")},error:function(){},dataType:"json",async:!0,type:"POST"})},e.prototype.touchBegin=function(t){this.beginX=t.stageX,this.beginY=t.stageY,this.beginTime=egret.getTimer(),console.log("touchBegin:"+this.beginY)},e.prototype.touchEnd=function(t){var e,i=t.stageX,n=t.stageY,a=i-this.beginX,o=n-this.beginY,r=egret.getTimer();Math.abs(a)>Math.abs(o)?(e=a/(r-this.beginTime),e>0?this.dir=4:this.dir=3):(e=o/(r-this.beginTime),e>0?this.dir=2:this.dir=1),console.log("touchEnd:"+e,a,o,i,this.beginX),Math.abs(e)<.3||(this.sendMsg(this.dir),this.timer.stop(),this.isTimeComp=!0,this.checkComp()&&Main.instance.showLogin())},e.prototype.onLoadComplete=function(t){var e=t.target,i=e.data;this.createView(new egret.Bitmap(i))},e.prototype.createView=function(t){var e=Global.createBitmapByName(Main.product_type+"_json.logo-white");e.x=500,e.y=20,t.width=this.stage.stageWidth,t.height=this.stage.stageHeight,t.alpha=0;egret.Tween.get(t).to({alpha:1},600);this.addChildAt(t,0),this.addChild(e)},e.prototype.setProgress=function(t,e){var i=t/e,n=Math.floor(i*StageUtils.SW);this.container.x=n,this.txtPro.text=Math.floor(100*i)+"%";var a=Math.floor(23*i);if(a>this.index)for(var o=a-this.index,r=0;o>r;r++){var s=Global.createBitmapByName("loading_bar_png");s.x=(StageUtils.SW-506>>1)+22*this.index,s.y=this.txtPro.y-50,this.addChild(s),this.index++}},e}(egret.Sprite);__reflect(LoadingUI1.prototype,"LoadingUI1");var LoginView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=Global.createBitmapByName("game_bg_png");t.width=StageUtils.stage.stageWidth,t.height=StageUtils.stage.stageHeight,this.addChild(t);var e=Global.createBitmapByName("login_bg_png");StageUtils.centerInParent(e,0,50),this.addChild(e);var i=Global.createBitmapByName("title_png");StageUtils.centerInParent(i,10,-350),this.addChild(i);var n=Global.createBitmapByName(Main.product_type+"_json.logo-blue");StageUtils.centerInParent(n,0,-500),this.addChild(n),this.btnStart=Global.createBitmapByName("start_png"),this.btnStart.x=50,this.btnStart.y=980,this.addChild(this.btnStart),this.btnGZ=Global.createBitmapByName("help-btn_png"),this.btnGZ.x=510,this.btnGZ.y=20,this.addChild(this.btnGZ),this.btnStart.touchEnabled=!0,this.btnStart.once(egret.TouchEvent.TOUCH_TAP,this.startClickHandler,this),this.btnGZ.touchEnabled=!0,this.btnGZ.addEventListener(egret.TouchEvent.TOUCH_TAP,this.gzClickHandler,this),Global.setBut(this.btnStart),Global.setBut(this.btnGZ);var a=new ManView;a.x=550,a.y=900,a.stand(),this.addChild(a)},e.prototype.startClickHandler=function(){Main.instance.showGame()},e.prototype.gzClickHandler=function(){Main.showPop("HelpPop")},e}(egret.DisplayObjectContainer);__reflect(LoginView.prototype,"LoginView");var Main=function(t){function e(){var i=t.call(this)||this;return e.instance=i,i.addEventListener(egret.Event.ADDED_TO_STAGE,i.onAddToStage,i),i}return __extends(e,t),Object.defineProperty(e,"USER_INFO_API",{get:function(){return e.ROOT+"info?"+Math.random()},enumerable:!0,configurable:!0}),Object.defineProperty(e,"PLAY_API",{get:function(){return e.ROOT+"play?"+Math.random()},enumerable:!0,configurable:!0}),e.prototype.onAddToStage=function(t){console.log(window.history.state),StageUtils.registStage(this.stage),this.getData()?this.loadConfig():e.showLost(21)},e.prototype.showLost=function(t){console.log("showLost",t);var e=new egret.Sprite;e.touchEnabled=!0;var i=new egret.Shape;i.graphics.beginFill(0,.8),i.graphics.drawRect(0,0,StageUtils.stage.stageWidth,StageUtils.stage.stageHeight),i.graphics.endFill(),e.addChild(i);var n=Global.createBitmapByName("error_png");StageUtils.centerInParent(n,0,-150),e.addChild(n);var a,o=new egret.TextField;o.background=!1,o.width=600,o.textColor=16777215,o.textAlign="center",o.size=36,0==t?a=Global.createBitmapByName("lost_png"):21==t?(o.text="错误的链接，请重新扫码...",e.addChild(o)):1==t?a=Global.createBitmapByName("lost_png"):2==t?a=Global.createBitmapByName("lost_png"):3==t?a=Global.createBitmapByName("scanned_png"):4==t?a=Global.createBitmapByName("lost_png"):5==t?a=Global.createBitmapByName("lost_png"):11==t?a=Global.createBitmapByName("max_png"):22==t?(a=Global.createBitmapByName("max-lost_png"),console.log("max-lost_pngmax-lost_pngmax-lost_png:"+a)):33==t?(o.text="码已经被抽过了...",e.addChild(o)):404==t?window.location.href="http://res.leasiondata.cn/lstatic/lsruleupgrade.html":(o.text="网络异常，请稍后再扫...",e.addChild(o)),o.y=600,o.x=20,a&&(StageUtils.centerInParent(a,0,150),e.addChild(a)),this.addChild(e),e.alpha=0;var r=egret.Tween.get(e);r.to({alpha:1},400)},e.showLost=function(t){e.instance.showLost(t)},e.prototype.showScanned=function(){var t=new Scanned;this.addChild(t)},e.prototype.getData=function(){var t,i=window.location.href.split("#")[0].split("?")[1];console.log("loadUser"),console.log("url: "+i);var n=egret.localStorage.getItem("kzw_type");if(n&&("1"==n?e.product_type="tk":"2"==n?e.product_type="yd":"3"==n&&(e.product_type="bv")),i&&i.length>20)return t=i.substr(0,32),e.user_ticket=t,console.log(t+" "+t.length),!0;var a=sessionStorage.getItem("yanjishoukuai");return console.log(a),a?!0:!1},e.prototype.loadUser=function(){if(console.log("loadUser"),e.isTest)return e.user={nickname:"jeff",headimgurl:"http://wx.qlogo.cn/mmopen/6BD2qP9V7sout0oux0ts55Pns1xtEpOl7icGF5GV68YdruILNBBCJvMMFCy0Wbbl7zFiaibjfibaIlKFcYIhRM6ntCU37lhk8amY/0"},void this.loadConfig();var t=this;$.ajax({url:e.USER_INFO_API,data:{ticket:e.user_ticket,desc:"test",url4wxjssdk:window.location.href.split("#")[0]},success:function(i){if("success"==i.result){e.user=i;for(var n,a=i.pools,o=a.length,r=0;o>r;r++){var s=a[r];if(s&&"yanjishoukuai"==s.type){n=s;break}}n&&n.ticket?t.loadConfig():t.showScanned()}else e.showLost(21)},error:function(){e.showLost(2)},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,i){"timeout"==i&&e.showLost(2)}})},e.prototype.loadConfig=function(){console.log("loadConfig"),RES.addEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.loadConfig("resource/default.res.json","resource/")},e.prototype.onConfigComplete=function(t){RES.removeEventListener(RES.ResourceEvent.CONFIG_COMPLETE,this.onConfigComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_COMPLETE,this.onResourceLoadComplete,this),RES.addEventListener(RES.ResourceEvent.GROUP_LOAD_ERROR,this.onResourceLoadError,this),RES.addEventListener(RES.ResourceEvent.GROUP_PROGRESS,this.onResourceProgress,this),RES.addEventListener(RES.ResourceEvent.ITEM_LOAD_ERROR,this.onItemLoadError,this),RES.loadGroup("preload")},e.prototype.onResourceLoadComplete=function(t){if("preload"==t.groupName&&("yd"==e.product_type?RES.loadGroup("yd_logo"):"tk"==e.product_type?RES.loadGroup("tk_logo"):"bv"==e.product_type&&RES.loadGroup("bv_logo")),"yd_logo"==t.groupName||"tk_logo"==t.groupName||"bv_logo"==t.groupName)this.loadingView=new LoadingUI1,this.addChild(this.loadingView),RES.loadGroup("main");else if("main"==t.groupName){this.loadingView.setLoadComp();var i=sessionStorage.getItem("yanjishoukuai");console.log(i),i&&e.showPop("EndView"),RES.loadGroup("music")}else"music"==t.groupName&&(SoundManager.getInstance().isLoad=!0)},e.prototype.onItemLoadError=function(t){console.warn("Url:"+t.resItem.url+" has failed to load")},e.prototype.onResourceLoadError=function(t){console.warn("Group:"+t.groupName+" has failed to load"),this.onResourceLoadComplete(t)},e.prototype.onResourceProgress=function(t){"main"==t.groupName&&this.loadingView.setProgress(t.itemsLoaded,t.itemsTotal)},e.prototype.outOld=function(t){var e=egret.Tween.get(t);e.to({y:-1040},600,egret.Ease.circIn),e.call(function(){t.parent&&t.parent.removeChild(t)})},e.prototype.showLogin=function(){if(this.loadingView&&this.loadingView.checkComp()){var t=new LoginView;this.addChildAt(t,0),this.loadingView.parent&&this.loadingView.parent.removeChild(this.loadingView),this.loadingView=null,this.oldView=t}},e.prototype.showGame=function(){var t=new GameView;this.addChildAt(t,0),this.outOld(this.oldView),this.oldView=t},e.showPop=function(t,i){void 0===i&&(i=null);var n=e.list[t];if(!n){var a=egret.getDefinitionByName(t),n=new a;n.setData(i),e.instance.addChild(n),e.list[t]=n}},e.removePop=function(t){var i=e.list[t];i&&(i.parent&&i.out(),e.list[t]=null,delete e.list[t])},e}(egret.DisplayObjectContainer);Main.product_type="yd",Main.isTest=!1,Main.ROOT="http://123.59.156.181:81/",Main.award={type:"cash",count:1},Main.list={},__reflect(Main.prototype,"Main");var Scanned=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){this.touchEnabled=!0;var t=(Math.floor(4*Math.random()),new egret.Shape);t.graphics.beginFill(0,.8),t.graphics.drawRect(0,0,StageUtils.stage.stageWidth,StageUtils.stage.stageHeight);var e=new Middle(Global.createBitmapByName("back_png")),i=new Middle(Global.createBitmapByName("button_store_png")),n=new Middle(Global.createBitmapByName("button_dzp_png"));e.x=320,e.y=480,i.x=320,i.y=620,n.x=320,n.y=720,this.addChild(t),this.addChild(e),this.addChild(i),this.addChild(n),n.alpha=e.alpha=i.alpha=0,Global.setBut(i),Global.setBut(n),Global.zoomIn(e,0,400,.6),Global.zoomIn(i,200,400,.6),Global.zoomIn(n,300,400,.6),n.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){"cash"==Main.award.type?window.location.href="rotating.html?ticket="+Main.user_ticket+"&aj=hb":window.location.href="rotating.html?ticket="+Main.user_ticket+"&aj=jf"},this),i.addEventListener(egret.TouchEvent.TOUCH_TAP,function(t){window.location.href="http://0k6.cn/a/gotoplaycity"},this)},e}(egret.Sprite);__reflect(Scanned.prototype,"Scanned");var GameTipView=function(t){function e(){var e=t.call(this)||this;return e.init(),e}return __extends(e,t),e.prototype.init=function(){var t=Global.createBitmapByName("game_tip1_png");StageUtils.centerInParent(t),this.addChild(t)},e}(egret.DisplayObjectContainer);__reflect(GameTipView.prototype,"GameTipView");var TipsView=function(t){function e(){var e=t.call(this)||this;return e.show(!1),e}return __extends(e,t),e.prototype.show=function(e){t.prototype.show.call(this,e),this.view.y=-50;var i=Global.createBitmapByName("pop_bg_png");StageUtils.centerInParent(i),this.view.addChild(i);var n=new CustomImage("resource/assets/reward/tips_1.png",!0,function(){n.x=StageUtils.SW-n.width>>1,n.y=StageUtils.SH-n.height>>1});this.view.addChild(n)},e}(PopUp);__reflect(TipsView.prototype,"TipsView");var AssetsUtils=function(){function t(){}return t.createBitmapByName=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=new egret.Bitmap,a=RES.getRes(t);return n.texture=a,n.x=e,n.y=i,n},t}();__reflect(AssetsUtils.prototype,"AssetsUtils");var CustomImage=function(t){function e(e,i,n){void 0===i&&(i=!0),void 0===n&&(n=null);var a=t.call(this)||this;return a.url=e,a.isEase=i,a.compFunc=n,a.loadBg(),a}return __extends(e,t),e.prototype.loadBg=function(){RES.getResByUrl(this.url,this.onLoadComplete,this,RES.ResourceItem.TYPE_IMAGE)},e.prototype.onLoadComplete=function(t){this.texture=t,this.isEase&&(this.alpha=0,egret.Tween.get(this).to({alpha:1},600)),this.compFunc&&this.compFunc()},e}(egret.Bitmap);__reflect(CustomImage.prototype,"CustomImage");var EventName=function(){function t(){}return t}();EventName.Start_Game="1",EventName.Logo_End="2",EventName.Ball_Click="3",EventName.Into_Content="4",__reflect(EventName.prototype,"EventName");var EventObj=function(t){function e(e,i,n,a,o){var r=t.call(this,e,n,a,o)||this;return r.name=i,r}return __extends(e,t),e}(egret.Event);__reflect(EventObj.prototype,"EventObj");var GameDispatcher=function(t){function e(){return t.call(this)||this}return __extends(e,t),Object.defineProperty(e,"instance",{get:function(){return e._instance||(e._instance=new e),e._instance},enumerable:!0,configurable:!0}),e}(egret.EventDispatcher);__reflect(GameDispatcher.prototype,"GameDispatcher");var Global=function(){function t(){}return t.createBitmapByRes=function(t,e){var i=new egret.Bitmap,n=RES.getRes(t);return console.log("name::"+e+"::"+t),i.texture=n.getTexture(e),i},t.createBitmapByName=function(t,e,i){void 0===e&&(e=0),void 0===i&&(i=0);var n=new egret.Bitmap,a=RES.getRes(t);return n.texture=a,n.x=e,n.y=i,n},t.fadeIn=function(e,i,n,a){void 0===i&&(i=0),void 0===n&&(n=500),void 0===a&&(a=1),t.tweenFrom(e,i,n,0,0,a,egret.Ease.cubicOut)},t.fadeOut=function(e,i,n,a){void 0===i&&(i=0),void 0===n&&(n=500),void 0===a&&(a=1),t.tweenToHide(e,i,n,0,0,a,egret.Ease.cubicOut)},t.zoomIn=function(e,i,n,a){void 0===i&&(i=0),void 0===n&&(n=500),void 0===a&&(a=.6),t.tweenFrom(e,i,n,0,0,a,egret.Ease.backOut)},t.zoomOut=function(e,i,n,a){void 0===i&&(i=0),void 0===n&&(n=500),void 0===a&&(a=1.5),t.tweenToHide(e,i,n,0,0,a,egret.Ease.cubicIn)},t.tweenToHide=function(t,e,i,n,a,o,r,s){void 0===s&&(s=0);var h=egret.Tween.get(t),l=t.x,d=t.y;l+=n,d+=a,h.wait(e),h.to({alpha:s,scaleX:o,scaleY:o,x:l,y:d},i,r),h.call(function(){t.parent&&t.parent.removeChild(t)})},t.tweenTo=function(t,e,i,n,a,o,r,s){void 0===o&&(o=1),void 0===r&&(r=1),void 0===s&&(s=egret.Ease.cubicOut);var h=egret.Tween.get(t);h.wait(e),s?h.to({alpha:o,scaleX:r,scaleY:r,x:n,y:a},i,s):h.to({alpha:o,scaleX:r,scaleY:r,x:n,y:a},i)},t.tweenFrom=function(t,e,i,n,a,o,r){var s=egret.Tween.get(t),h=t.x,l=t.y;t.scaleX=t.scaleY=o,t.x=h+n,t.y=l+a,s.wait(e),s.to({alpha:1,scaleX:1,scaleY:1,x:h,y:l},i,r)
},t.createMc=function(t,e,i){var n=RES.getRes(t),a=RES.getRes(e),o=new egret.MovieClipDataFactory(n,a),r=new egret.MovieClip(o.generateMovieClipData(i));return r},t.remove=function(t){t&&t.parent&&t.parent.removeChild(t)},t.setBut=function(t){t&&(t.touchEnabled=!0,t.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(){t.alpha=.68},t),t.addEventListener(egret.TouchEvent.TOUCH_END,function(){t.alpha=1},t),t.addEventListener(egret.TouchEvent.TOUCH_RELEASE_OUTSIDE,function(){t.alpha=1},t))},t.getArrayItems=function(t,e){var i=new Array;for(var n in t)i.push(t[n]);for(var a=new Array,o=0;e>o&&i.length>0;o++){var r=Math.floor(Math.random()*i.length);a[o]=i[r],i.splice(r,1)}return a},t}();__reflect(Global.prototype,"Global");var HttpService=function(){function t(t,e){void 0===e&&(e=egret.HttpMethod.GET),this.data=t,this.post=e}return t.prototype.exec=function(){var t=new egret.HttpRequest;t.responseType=egret.HttpResponseType.TEXT,this.post==egret.HttpMethod.GET?t.open(this.url+"?"+this.data,this.post):t.open(this.url,this.post),t.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),t.addEventListener(egret.Event.COMPLETE,this.onComplete,this),t.addEventListener(egret.IOErrorEvent.IO_ERROR,this.onIOError,this),this.post==egret.HttpMethod.GET?t.send(this.data):t.send()},t.prototype.onComplete=function(t){var e=t.currentTarget;this.result(e.response)},t.prototype.onIOError=function(){},t.prototype.result=function(t){},t}();__reflect(HttpService.prototype,"HttpService");var Message=function(t){function e(){var e=t.call(this)||this;return e.bg=Global.createBitmapByName("message_bg_png"),e.bg.y=-10,e.addChild(e.bg),e.txtStr=new egret.TextField,e.txtStr.width=StageUtils.SW,e.txtStr.textAlign=egret.HorizontalAlign.CENTER,e.addChild(e.txtStr),e}return __extends(e,t),e.prototype.show=function(t){this.txtStr.text=t,this.bg.width=this.txtStr.textWidth+50,this.bg.height=this.txtStr.textHeight+20,this.bg.x=StageUtils.SW-this.bg.width>>1,this.y=StageUtils.SH>>1,this.alpha=1,egret.Tween.get(this).wait(1e3).to({y:this.y-100,alpha:0},1e3,egret.Ease.quadIn).call(this.tweenEnd,this)},e.prototype.tweenEnd=function(){this.parent&&(this.parent.removeChild(this),e.pool.push(this))},e.show=function(t){var i;i=e.pool.length>0?e.pool.pop():new e,i&&(i.show(t),Main.instance.addChild(i))},e}(egret.DisplayObjectContainer);Message.pool=[],__reflect(Message.prototype,"Message");var Middle=function(t){function e(e){var i=t.call(this)||this;return e.x=e.width/-2,e.y=e.height/-2,i.addChild(e),i}return __extends(e,t),e}(egret.Sprite);__reflect(Middle.prototype,"Middle");var EndView=function(_super){function EndView(){var t=_super.call(this)||this;return t.show(!1),t}return __extends(EndView,_super),EndView.prototype.show=function(hasDelay){_super.prototype.show.call(this,hasDelay),this.view.y=-50;var bg=Global.createBitmapByName("pop_bg_png");StageUtils.centerInParent(bg),this.view.addChild(bg),Main.isTest&&(GameView.rewardData={desc:"thankyou"});var prizes=sessionStorage.getItem("yanjishoukuai");if(prizes){if(prizes=eval("("+prizes+")"),GameView.rewardData=prizes,console.log(prizes),"thankyou"==GameView.rewardData.desc||-1==GameView.rewardData.id){var reward=new CustomImage("resource/assets/reward/thankyou.png",!0,function(){reward.x=StageUtils.SW-reward.width>>1,reward.y=StageUtils.SH-reward.height>>1});return void this.view.addChild(reward)}var reward=new CustomImage("resource/assets/reward/"+GameView.rewardData.desc+".png",!0,function(){reward.x=StageUtils.SW-reward.width>>1,reward.y=StageUtils.SH-reward.height>>1});this.view.addChild(reward)}else{if(SoundManager.getInstance().play("open_mp3"),"thankyou"==GameView.rewardData.desc){var reward=new CustomImage("resource/assets/reward/"+GameView.rewardData.desc+".png",!0,function(){reward.x=StageUtils.SW-reward.width>>1,reward.y=StageUtils.SH-reward.height>>1});return void this.view.addChild(reward)}var reward=new CustomImage("resource/assets/reward/"+GameView.rewardData.desc+".png",!0,function(){reward.x=StageUtils.SW-reward.width>>1,reward.y=StageUtils.SH-reward.height-240});this.view.addChild(reward)}var toReceive=Global.createBitmapByName("btn_get_png");toReceive.x=StageUtils.SW-toReceive.width>>1,toReceive.y=StageUtils.SH-100,this.view.addChild(toReceive),Global.setBut(toReceive),Global.zoomIn(toReceive,0,400,.6),toReceive.addEventListener(egret.TouchEvent.TOUCH_TAP,function(){"thankyou"==GameView.rewardData.desc||(Main.removePop("EndView"),Main.showPop("SubmitView"))},this)},EndView.prototype.gotoReward=function(){0!=GameView.rewardData.length?window.location.href="link":(Main.removePop("EndView"),Main.showPop("SubmitView"))},EndView.prototype.saveLuck=function(){$.ajax({url:Main.PLAY_API,data:{ticket:GameView.rewardData.ticket},success:function(t){if("success"==t.result)if(""!=t.prizes[0].require){var e=sessionStorage.getItem("kzw_href");e&&window.history.replaceState(null,null,e),window.location.href=GameView.rewardData.link}else Main.showLost(1);else"invalidticketparam"==t.reason?Main.showLost(21):"invalidticket"==t.reason?Main.showLost(3):Main.showLost(1)},error:function(){Main.showLost(2)},timeout:8e3,dataType:"json",async:!0,type:"POST",complete:function(t,e){"timeout"==e&&Main.showLost(2)}})},EndView}(PopUp);__reflect(EndView.prototype,"EndView");var SoundManager=function(){function t(){}return t.getInstance=function(){return t._instance||(t._instance=new t),t._instance},t.prototype.play=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=1),this.isLoad){var n=RES.getRes(t);n.play(e,i)}},t}();__reflect(SoundManager.prototype,"SoundManager");var StageUtils=function(){function t(){}return t.registStage=function(e){t.stage=e,t.SW=e.stageWidth,t.SH=e.stageHeight,t.CW=t.SW>>1,t.CH=t.SH>>1,t.LW=window.innerWidth,t.LH=window.innerHeight},t.centerInParentX=function(e,i){void 0===i&&(i=null),e&&(i?e.x=i.width-e.width>>1:e.x=t.stage.stageWidth-e.width>>1)},t.centerInParentY=function(e,i){void 0===i&&(i=null),e&&(i?e.y=i.height-e.height>>1:e.y=t.stage.stageHeight-e.height>>1)},t.centerInParent=function(e,i,n,a){void 0===i&&(i=0),void 0===n&&(n=0),void 0===a&&(a=null),e&&(a?(e.x=(a.width-e.width>>1)+i,e.y=(a.height-e.height>>1)+n):(e.x=(t.stage.stageWidth-e.width>>1)+i,e.y=(t.stage.stageHeight-e.height>>1)+n))},t}();__reflect(StageUtils.prototype,"StageUtils");